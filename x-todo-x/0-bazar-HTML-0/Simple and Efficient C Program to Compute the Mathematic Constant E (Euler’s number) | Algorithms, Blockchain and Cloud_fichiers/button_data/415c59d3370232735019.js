(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{269:function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.isCivicLikerTrial||e.isSubscribedCivicLiker?"civic-liker":"none"}n.d(t,"a",(function(){return r}))},301:function(e,t,n){"use strict";n.r(t);n(69),n(55);var r=n(65),o=(n(67),n(68),n(116)),c=(n(66),n(48),n(39),n(38),n(54),n(62),n(24)),h=(n(158),n(28),n(31)),l=n(253),d=n(269),k=n(258),f=n(278);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function w(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(h.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m={mixins:[f.a],data:function(){return{isUserFetched:!1,isDisplayed:!1,isInteracted:!1,isReadTimerEnded:!1,readTimer:null}},computed:{popupURL:function(){var e="/in/like/".concat(this.id,"/?referrer=").concat(encodeURIComponent(this.referrer));return this.buttonType&&(e+="&type=".concat(encodeURIComponent(this.buttonType))),e},isPreview:function(){return"1"===this.$route.query.preview}},head:function(){var link=[];return this.isUserFetched&&!this.isLoggedIn&&(this.hasCookieSupport?window.doNotTrack||navigator.doNotTrack||link.push({rel:"prefetch",href:this.signUpURL}):link.push({rel:"prefetch",href:this.popupURL})),{link:link}},mounted:function(){var e=this;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(window.addEventListener("message",this.handleWindowMessage),!this.isPreview){t.next=3;break}return t.abrupt("return");case 3:return this.readTimer=setTimeout((function(){e.isReadTimerEnded=!0}),1e4),t.next=6,regeneratorRuntime.awrap(this.getIsCookieSupport());case 6:return this.hasCookieSupport=t.sent,this.parentSuperLikeID=this.getParentSuperLikeID(),t.next=10,regeneratorRuntime.awrap(this.updateUserSignInStatus());case 10:this.onCheckCookieSupport&&this.onCheckCookieSupport(this.hasCookieSupport),this.isUserFetched=!0;case 12:case"end":return t.stop()}}),null,this)},beforeDestroy:function(){window.removeEventListener("message",this.handleWindowMessage)},watch:{referrer:function(){this.updateUserSignInStatus()},isDisplayed:function(){this.checkShouldPostReadEvent()},isInteracted:function(){this.checkShouldPostReadEvent()},isReadTimerEnded:function(){this.checkShouldPostReadEvent()}},methods:{openPopup:function(e){var t="".concat(this.popupURL,"&action=").concat(e);if(Object(o.e)()&&Object(o.f)())try{return void(window.top.location.href=t)}catch(e){console.error(e)}var n=window.open(t,"like","menubar=no,location=no,width=576,height=768");this.$root.$emit("openPopupNoticeOverlay",n)},setIsDisplayed:function(){this.isDisplayed=!0},setIsInteracted:function(){this.isInteracted=!0},checkShouldPostReadEvent:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRead||!(this.isReadTimerEnded&&this.isDisplayed||this.isInteracted)){e.next=3;break}return e.next=3,regeneratorRuntime.awrap(this.postReadEvent());case 3:case"end":return e.stop()}}),null,this)},postReadEvent:function(){var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRead){t.next=2;break}return t.abrupt("return");case 2:return this.isRead=!0,t.prev=3,t.next=6,regeneratorRuntime.awrap(Object(k.p)(this.id,w({referrer:this.referrer,isCookieSupport:this.hasCookieSupport},this.apiMetadata)));case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),(e=t.t0.message||t.t0.toString()).includes("timeout")||e.includes("Network Error")||console.error(t.t0);case 12:this.readTimer&&clearTimeout(this.readTimer);case 13:case"end":return t.stop()}}),null,this,[[3,8]])},handleWindowMessage:function(e){var data,t,n,r=this;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(data=e.data,"object"===Object(c.a)(data)){o.next=3;break}return o.abrupt("return");case 3:if(e.source!==window.parent&&e.source!==window.top){o.next=12;break}o.t0=data.action,o.next="SET_REFERRER"===o.t0?7:12;break;case 7:if(void 0!==(t=data.content.referrer)){o.next=10;break}return o.abrupt("return");case 10:return this.$router.replace({name:this.$route.name,params:this.$route.params,hash:this.$route.hash,query:w({},this.$route.query,{referrer:t})}),o.abrupt("break",12);case 12:if(e.origin!=="https://".concat(l.f)){o.next=34;break}o.t1=data.action,o.next="LOGGED_IN"===o.t1?16:"PREVIEW"===o.t1?29:34;break;case 16:return o.next=18,regeneratorRuntime.awrap(this.updateUserSignInStatus());case 18:o.t2=this.postSignInAction,o.next="like"===o.t2?21:"save"===o.t2?23:"follow"===o.t2?25:27;break;case 21:return this.$nextTick((function(){r.$refs.likeButton&&r.$refs.likeButton.onClick()})),o.abrupt("break",28);case 23:return this.hasBookmarked||this.onClickSaveButton(),o.abrupt("break",28);case 25:return this.hasFollowedCreator||this.onClickFollowButton(),o.abrupt("break",28);case 27:return o.abrupt("break",28);case 28:return o.abrupt("break",34);case 29:if(this.isPreview){o.next=31;break}return o.abrupt("return");case 31:return(n=data.content.user)&&(n.user&&(this.id=n.user),n.displayName&&(this.displayName=n.displayName),n.avatar&&(this.avatar=n.avatar),this.avatarHalo=Object(d.a)(n)),o.abrupt("break",34);case 34:case"end":return o.stop()}}),null,this)}}},S=n(273),C=n(279),L=n(272),y=n(275),x=n(260),O={name:"embed-id-button",layout:"embedv2",components:{Identity:S.a,LikeCoinButtonWidget:C.c,LikeButton:L.a,SaveButton:y.a},mixins:[m],data:function(){return{isUserFetched:!1,isShowAltMode:!1,intersectionObserver:null}},computed:{widgetLayout:function(){if(this.isShowAltMode){var e=this.$route.query.mode;if(C.a.includes(e))return e}return C.b},hasAltMode:function(){var e=this.$route.query.mode;return C.a.includes(e)&&e!==C.b}},mounted:function(){var e=this;this.hasAltMode&&(this.isShowAltMode=!0,window.addEventListener("message",this.onReceiveMessage,!1)),window.IntersectionObserver&&(this.intersectionObserver||(this.intersectionObserver=new IntersectionObserver((function(t){var n=Object(r.a)(t,1)[0];n&&n.isIntersecting&&e.setIsDisplayed()}))),this.intersectionObserver.observe(this.$el))},beforeDestory:function(){window.removeEventListener("message",this.onReceiveMessage,!1)},destroyed:function(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null)},methods:{onClickInteraction:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:this.setIsInteracted();case 1:case"end":return e.stop()}}),null,this)},doLogin:function(e){var t;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isPreview){n.next=2;break}return n.abrupt("return");case 2:if(this.postSignInAction=e,!(!this.hasCookieSupport||Object(o.e)()&&Object(o.f)())){n.next=18;break}if(this.openPopup(e),t=e.replace(/^./,(function(s){return s.toUpperCase()})),Object(x.a)(this,"LikeButtonFlow","popup".concat(t),"popup".concat(t,"(embed)"),1),this.hasStorageAPIAccess){n.next=16;break}return n.next=10,regeneratorRuntime.awrap(Object(o.g)());case 10:if(!n.sent){n.next=16;break}return n.next=13,regeneratorRuntime.awrap(this.getIsCookieSupport());case 13:return this.hasCookieSupport=n.sent,n.next=16,regeneratorRuntime.awrap(this.updateUserSignInStatus());case 16:n.next=20;break;case 18:this.signUp(),Object(x.a)(this,"LikeButtonFlow","popupSignUp","popupSignUp(embed)",1);case 20:case"end":return n.stop()}}),null,this)},doLike:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMaxLike||this.isCreator){e.next=5;break}this.like(),Object(x.a)(this,"LikeButtonFlow","clickLike","clickLike(embed)",1),e.next=13;break;case 5:if(!this.canSuperLike){e.next=12;break}return e.next=8,regeneratorRuntime.awrap(this.newSuperLike());case 8:return e.next=10,regeneratorRuntime.awrap(this.updateSuperLikeStatus());case 10:e.next=13;break;case 12:this.showCivicLikerCTA();case 13:case"end":return e.stop()}}),null,this)},getShouldShowCivicLikerCTA:function(){if(void 0===this.ctaClickCount)this.ctaClickCount=1;else if(this.ctaClickCount=(this.ctaClickCount+1)%5,0!==this.ctaClickCount)return!1;return!0},showCivicLikerCTA:function(){this.getShouldShowCivicLikerCTA()&&(this.goToPortfolio({type:"popup",target:"civic-liker-cta",feature:"width=540,height=640,menubar=no,location=no,resizable=yes,scrollbars=yes,status=yes"}),Object(x.a)(this,"LikeButtonFlow","clickCivicLikerCTA","clickCivicLikerCTA(embed)",1))},onClickLike:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(x.a)(this,"LikeButtonFlow","clickLikeButton","clickLikeButton(embed)",1),!this.isLoggedIn){e.next=5;break}this.doLike(),e.next=7;break;case 5:return e.next=7,regeneratorRuntime.awrap(this.doLogin("like"));case 7:case"end":return e.stop()}}),null,this)},onClickLikeStats:function(){this.openLikeStats(),Object(x.a)(this,"LikeButtonFlow","clickLikeStats","clickLikeStats(embed)",1)},onClickAvatar:function(){Object(x.a)(this,"LikeButtonFlow","clickAvatar","clickAvatar(embed)",1),this.goToPortfolio()},onClickSaveButton:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(x.a)(this,"LikeButtonFlow","clickSaveButton","clickSaveButton(embed)",1),!this.isLoggedIn){e.next=5;break}this.toggleBookmark(),e.next=7;break;case 5:return e.next=7,regeneratorRuntime.awrap(this.doLogin("save"));case 7:case"end":return e.stop()}}),null,this)},handleMessageAction:function(e,t){switch(t){case"showAltMode":this.isShowAltMode=!0;break;case"hideAltMode":this.isShowAltMode=!1}e&&e.source&&e.source.postMessage(JSON.stringify({ack:t}),e.origin)},onReceiveMessage:function(e){var t=this,n=[];try{n=JSON.parse(e.data).actions}catch(e){return void console.error(e)}Array.isArray(n)?n.forEach((function(n){t.handleMessageAction(e,n)})):this.handleMessageAction(e,n)}}},R=n(19),component=Object(R.a)(O,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{on:{click:e.onClickInteraction}},[n("LikeCoinButtonWidget",{attrs:{layout:e.widgetLayout,"like-button-label":e.likeButtonLabel,"cta-button-label":e.ctaButtonLabel,"cta-button-preset":e.ctaButtonPreset,hintLabel:e.hintText},on:{"click-like-button-label":e.onClickLikeStats,"click-cta-button":e.onClickCTAButton},scopedSlots:e._u([{key:"like-button",fn:function(){return[n("LikeButton",{ref:"likeButton",attrs:{count:e.likeCount,cooldown:e.cooldownProgress,"cooldown-end-time":e.nextSuperLikeTime,"has-super-liked":e.hasSuperLiked,"is-just-super-liked":e.isJustSuperLiked,"is-super-like-enabled":e.isSuperLiker,"is-creator":e.isCreator},on:{click:e.onClickLike,"click-disabled":e.onClickCooldown,"cooldown-end":e.updateSuperLikeStatus}})]},proxy:!0},{key:"save-button",fn:function(t){return[n("SaveButton",e._b({attrs:{toggled:e.hasBookmarked},on:{click:e.onClickSaveButton}},"SaveButton",t,!1))]}},{key:"identity",fn:function(t){return[n("Identity",e._b({attrs:{avatarURL:e.avatar,"display-name":e.displayName,"is-avatar-button-outlined":e.isCreatorCivicLiker},on:{"click-avatar":e.onClickAvatar,"click-display-name":e.onClickAvatar}},"Identity",t,!1))]}}])})],1)}),[],!1,null,null,null);t.default=component.exports}}]);
//# sourceMappingURL=415c59d3370232735019.js.map