/*! 20200812-22-RELEASE 2020-08-12 */

(()=>{const e={CONTAINER_ID:"tbl-feed-view-container",CONTAINER_IOS:"tbl-feed-view-ios-container",IFRAME_ID:"tbl-feed-view-frame",CONTAINER_SLIDE_IN:`tbl-feed-view-container-slide-in`,CONTAINER_SLIDE_OUT:`tbl-feed-view-container-slide-out`,HEADER_ID:"tbl-feed-view-header",HEADER_TITLE:"tbl-feed-view-header-title",HEADER_CLOSE_BUTTON:"tbl-feed-view-header-close-btn",BODY_CONTAINER_CLASS:"tbl-feed-view-parent-wrapper",RTL_CLASS:"tbl-feed-view-rtl",FULL_MODE:"tbl-feed-view-full-mode",HIDDEN_ARTICLE:"tbl-feed-view-hidden-article"},t={SHOW:"tbl-show-explore-more",HIDE_ORIGINAL_HEADER:"tbl-explore-more-hide-original-header"},i=TRC.ExploreMore?TRC.ExploreMore.CSS_CLASSES:t,o={FEED_VIEW_BEFORE_LOAD:"feed-view-before-load",FEED_VIEW_AFTER_IFRAME_LOADED:"feed-view-after-iframe-loaded",FEED_VIEW_BEFORE_IFRAME_CLOSE:"feed-view-before-iframe-close"};class n{constructor(t,s,r){this.item=s,this.itemContainer=r,this.rbox=t,this.trcManager=t.trc,this.feedViewMaxRetries=this.trcManager.global["feed-view-max-retries"]||5,this.feedViewRetryInterval=this.trcManager.global["feed-view-retry-interval"]||500,this.originalUrl=window.location.href,this.originalState=window.history.state,this.checkUrlChange={interval:"",lastUrl:""},this.isMobile=TRC.dom.isSmartPhone(),this.initialHistoryLength=history.length,this.backClicks=0,this.thirdPreviousTitle=null,n.feedViewCssInjected||(n.feedViewCssInjected=!0,TRC.dom.injectStyle(`.${e.BODY_CONTAINER_CLASS} body.${i.SHOW}.${i.HIDE_ORIGINAL_HEADER} #${e.CONTAINER_ID} { display: block; }.${e.BODY_CONTAINER_CLASS} body.${i.SHOW} #${e.CONTAINER_ID} { display: block; }#${e.CONTAINER_ID} { position: absolute; left: 0; top: 0; width: 100%; min-height: 100vh; background-color: #ffffff; } #${e.CONTAINER_ID}.${e.FULL_MODE} #${e.IFRAME_ID} { top: 0px; height: 100vh; } #${e.CONTAINER_ID}.${e.CONTAINER_SLIDE_IN} #${e.HEADER_ID} { -webkit-animation: feed-view-slide-top 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -moz-animation: feed-view-slide-top 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -ms-animation: feed-view-slide-top 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -o-animation: feed-view-slide-top 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; animation: feed-view-slide-top 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; will-change: auto; } #${e.CONTAINER_ID}.${e.CONTAINER_SLIDE_OUT} { -webkit-animation: feed-view-slide-bottom 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -moz-animation: feed-view-slide-bottom 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -ms-animation: feed-view-slide-bottom 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; -o-animation: feed-view-slide-bottom 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; animation: feed-view-slide-bottom 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; will-change: auto; } #${e.CONTAINER_ID} #${e.HEADER_ID} { position: fixed; z-index: 999999999; width: 100%; } #${e.CONTAINER_ID} #${e.HEADER_ID} .tbl-header-content { height: 40px; width: 100%; font-size: 14px; line-height: 18px; font-family: Roboto, Arial; color: #154c91; background-color: #ffffff; border-bottom: 1px solid #cccccc; display: flex; flex-direction: row; justify-content: space-between; padding: 10px 15px; box-sizing: border-box; } #${e.CONTAINER_ID} #${e.HEADER_ID} .${e.HEADER_CLOSE_BUTTON} { flex: 2; } #${e.CONTAINER_ID} #${e.HEADER_ID} .${e.HEADER_CLOSE_BUTTON} .tbl-close-btn-svg { display: block; fill: #696969; } #${e.CONTAINER_ID} #${e.HEADER_ID} .tbl-article-icon-svg { margin: 0 10px; } #${e.CONTAINER_ID} #${e.HEADER_ID} .${e.HEADER_TITLE} { flex: 12; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; word-wrap: normal; padding: 0 10% 0 0; } #${e.CONTAINER_ID}.${e.RTL_CLASS} #${e.HEADER_ID} .tbl-header-content { direction: rtl; } #${e.CONTAINER_ID}.${e.RTL_CLASS} #${e.HEADER_ID} .${e.HEADER_TITLE} { padding: 0 0 0 10%; } #${e.CONTAINER_ID} #${e.IFRAME_ID} { border: 0; overflow: hidden; display: block; width: 100%; position: relative; top: 40px; left: 0; bottom: 0; height: calc(100vh - 40px); } #${e.CONTAINER_ID}.${e.CONTAINER_IOS}.${e.FULL_MODE}.${e.CONTAINER_SLIDE_IN} { height: 100%; overflow-y: scroll; min-height: 0; } #${e.CONTAINER_ID}.${e.CONTAINER_IOS}.${e.FULL_MODE} #${e.IFRAME_ID} { top: 0px; height: 100vh; } #${e.CONTAINER_ID}.${e.CONTAINER_IOS} #${e.HEADER_ID} { background-color: #5a5a5a; } #${e.CONTAINER_ID}.${e.CONTAINER_IOS} .tbl-ios-header { height: 10px; width: 100%; text-align: center; position: relative; } #${e.CONTAINER_ID}.${e.CONTAINER_IOS} .tbl-ios-header:after { content: ''; height: 2px; border-radius: 1px; background-color: #939393; width: 24px; position: absolute; top: 50%; transform: translateY(-50%); } #${e.CONTAINER_ID}.${e.CONTAINER_IOS} .tbl-header-content { border-radius: 6px 6px 0 0; } #${e.CONTAINER_ID}.${e.CONTAINER_IOS} #${e.IFRAME_ID} { top: 50px; }.${e.BODY_CONTAINER_CLASS}.${e.HIDDEN_ARTICLE} body > *:not(#${e.CONTAINER_ID}) { display: none; }@-webkit-keyframes feed-view-slide-top { 0% { -webkit-transform: translateY(100vh); } 100% { -webkit-transform: translateY(0); } }@keyframes feed-view-slide-top { 0% { transform: translateY(100vh); } 100% { transform: translateY(0); } }@-webkit-keyframes feed-view-slide-bottom { 0% { -webkit-transform: translateY(0); } 100% { -webkit-transform: translateY(100vh); } }@keyframes feed-view-slide-bottom { 0% { transform: translateY(0); } 100% { transform: translateY(100vh); } }`,null)),this.dispatchHook(o.FEED_VIEW_BEFORE_LOAD),this.rbox.feedViewConfig.disableHandlePublisherChangesToFeedView?history.replaceState({feedViewEventName:"feed-view-init"},this.originalUrl):history.pushState({feedViewEventName:"feed-view-init"},this.originalUrl),this.setFeedViewConfig(),this.createContainer(),this.pageIsLoading="complete"!==document.readyState,this.pageIsLoading&&this.feedViewConfig.addUrlCheck&&this.startUrlIntervalCheck(this.postStateHandler)}setFeedViewConfig(){const{feedViewDisableHistoryCheck:e=!1,hideHeader:t=!0,addUrlCheck:i=!1,urlCheckIntervalTime:o=200,addSearchToUrl:n=!0,disableHandlePublisherChangesToFeedView:s=!1,useItemAtTopOfViewportReturnPosition:r=!0,stopObserveForPolyfillSeconds:a=5}=this.rbox.feedViewConfig;this.feedViewConfig={feedViewDisableHistoryCheck:e,hideHeader:t,addUrlCheck:i,urlCheckIntervalTime:o,addSearchToUrl:n,disableHandlePublisherChangesToFeedView:s,useItemAtTopOfViewportReturnPosition:r,stopObserveForPolyfillSeconds:a},this.feedViewConfig.feedViewHistoryCheck=!this.feedViewConfig.feedViewDisableHistoryCheck}dispatchHook(e){return TRC.CustomModulesManager.runHook(e,null,this)}createContainer(){this.bodyElem=document.body,this.htmlElem=document.documentElement,this.htmlElem.className.indexOf(e.BODY_CONTAINER_CLASS)<0&&(TRC.dom.addClass(this.htmlElem,e.BODY_CONTAINER_CLASS),this.isMobile&&TRC.dom.addClass(this.htmlElem,e.HIDDEN_ARTICLE));let t=this.item.logger_url;this.trcManager.global["enable-feed-view-redirect-url"]||(t=this.item.url,n.reportClick(this.item));const i=this.rbox.isSmallIOS,s="rtl"===this.trcManager.direction,{hideHeader:r}=this.feedViewConfig,a=r?`${e.FULL_MODE} ${e.CONTAINER_SLIDE_IN}`:e.CONTAINER_SLIDE_IN,l=`<div id="${e.CONTAINER_ID}" class="${a}">\n                        ${r?"":n.createIframeHeader(i)}\n                        ${n.createIframe(t)}\n                </div>`;if(this.bodyElem.insertAdjacentHTML("beforeend",l),this.container=document.getElementById(e.CONTAINER_ID),this.iframe=document.getElementById(e.IFRAME_ID),this.feedViewConfig.hideHeader||(this.closeBtn=document.querySelector(`.${e.HEADER_CLOSE_BUTTON}`),this.title=document.querySelector(`.${e.HEADER_TITLE}`)),s&&TRC.dom.addClass(this.container,e.RTL_CLASS),i&&TRC.dom.addClass(this.container,e.CONTAINER_IOS),this.isMobile&&TRC.dom.on(window,"resize",this.setMobileContainerAndIframeHeight.trcBind(this)),this.listenToIframeLoad(),this.feedViewConfig.hideHeader||this.listenToAnimationEnd(),this.postStateHandler=(()=>{this.dispatchHook(o.FEED_VIEW_BEFORE_IFRAME_CLOSE),this.feedViewConfig.disableHandlePublisherChangesToFeedView||(TRC.dom.off(window.top,"popstate",this.postStateHandler),history.go(-1));const{feedViewHistoryCheck:e,hideHeader:t}=this.feedViewConfig;t?(this.iframe.contentWindow&&TRC.dom.off(this.iframe.contentWindow,"unload",this.onUnload),n.removeIframe(this.trcManager,this.container,this.title,this.originalUrl,this.originalState,"back",e,t,this.isMobile),TRC.Timeout.set(()=>this.itemContainer.scrollIntoView(this.feedViewConfig.useItemAtTopOfViewportReturnPosition),0)):n.removeIframe(this.trcManager,this.container,this.title,this.originalUrl,this.originalState,"back",e,t,this.isMobile),this.feedViewConfig.disableHandlePublisherChangesToFeedView&&TRC.dom.off(window.top,"popstate",this.postStateHandler),this.checkUrlChange.interval&&this.stopIntervalUrlCheck()}),TRC.dom.on(window.top,"popstate",this.postStateHandler),!this.feedViewConfig.hideHeader){const{feedViewHistoryCheck:e,hideHeader:t}=this.feedViewConfig;this.title.innerText=TRC.text.htmlUnescape(this.item.title),TRC.dom.on(this.closeBtn,"click",()=>{this.dispatchHook(o.FEED_VIEW_BEFORE_IFRAME_CLOSE),n.removeIframe(this.trcManager,this.container,this.title,this.originalUrl,this.originalState,"closeBtn",e,t,this.isMobile),this.checkUrlChange.interval&&this.stopIntervalUrlCheck()})}this.modifyPageHistory(this.title,this.item.url,null,"pushState","feedView"),this.feedViewConfig.disableHandlePublisherChangesToFeedView||(this.stopObserveForPolyfillSeconds=this.feedViewConfig.stopObserveForPolyfillSeconds||5,this.observeChangesOnFeedView())}setMobileContainerAndIframeHeight(){this.iframe.style.height=`${window.innerHeight}px`,this.container.style.height=`${window.innerHeight}px`}observeChangesOnFeedView(){window.requestAnimationFrame&&window.MutationObserver?this.observeChanges():this.feedViewObserverPolyfill()}observeChanges(){const e={attributes:!0,childList:!1},t={attributes:!0,childList:!0},i=e=>{window.requestAnimationFrame(()=>{this.handlePublisherChangesToFeedView(e)})},o=new MutationObserver(i);o.observe(this.iframe,e),o.observe(this.container,t)}feedViewObserverPolyfill(){const t=TRC.Interval.set(()=>{this.iframe.removeAttribute("style"),this.container.removeAttribute("style")},500),i=TRC.Interval.set(()=>{const t=this.container.children;for(let i=0;i<t.length;i++){const o=t[i],n=o.id;(void 0===n||n!==e.IFRAME_ID&&"tbl-fvd-close-btn-wrapper"!==n)&&this.handlePublisherAddedHTMLToFeedViewContainer(o)}},500);TRC.Timeout.set(()=>{TRC.Interval.clear(t),TRC.Interval.clear(i)},1e3*this.stopObserveForPolyfillSeconds)}handlePublisherChangesToFeedView(e){for(let t=0;t<e.length;t++){const i=e[t];if("childList"===i.type){const{addedNodes:e}=i;for(let t=0;t<e.length;t++){const i=e[t];t===e.length-1&&this.handlePublisherAddedHTMLToFeedViewContainer(i)}}else if("attributes"===i.type){const e=i.attributeName;"style"===e&&i.target.removeAttribute(e)}}}handleReturnToInitialPageOnPublisherModificationOfFeedView(){window.location.href=this.currentLocation,TRC.dom.removeClass(this.htmlElem,e.BODY_CONTAINER_CLASS),this.isMobile&&TRC.dom.removeClass(this.htmlElem,e.HIDDEN_ARTICLE)}handlePublisherAddedHTMLToFeedViewContainer(e){e.remove(),TRC.dom.off(window.top,"popstate",this.postStateHandler),TRC.dom.on(window.top,"popstate",this.handleReturnToInitialPageOnPublisherModificationOfFeedView.trcBind(this)),this.currentLocation=this.iframe.contentDocument&&this.iframe.contentDocument.URL||window.location.href,this.bodyElem.style.display="none",this.iframe.remove();const t=history.length-this.initialHistoryLength-this.backClicks;history.go(-t)}startUrlIntervalCheck(e){this.checkUrlChange.interval=TRC.Interval.set(()=>{const t=window.location.href;this.originalUrl===t&&e(),this.checkUrlChange.lastUrl=t},this.feedViewConfig.urlCheckIntervalTime)}stopIntervalUrlCheck(){TRC.Interval.clear(this.checkUrlChange.interval)}listenToAnimationEnd(){const e=TRC.dom.detectAnimationEvent(this.itemContainer,"end")||"animationend";TRC.dom.on(this.container,e,e=>this.animationEndHandler(e))}checkIfUserHitBack(){this.currentTitle===this.thirdPreviousTitle&&this.backClicks++}onIframeLoad(){this.checkIfUserHitBack();const t=this.iframe.contentDocument&&this.iframe.contentDocument.URL||window.location.href,i=this.title||window.top.document.querySelector(`.${e.HEADER_TITLE}`);let o=this.currentTitle;this.trcManager.sendAbTestEvent("feedView_iframe_pv","on_iframe_load"),o&&""!==o||(o=this.rbox.getPublisherBrandingName()||TRC.publisherId),i&&i.innerText!==o&&(this.title.innerText=TRC.text.htmlUnescape(o)),top.document.title=o,this.modifyPageHistory(o,t,null,"replaceState","feedView")}checkIfNewTitleExist(e=0){this.currentTitle=this.iframe.contentDocument&&this.iframe.contentDocument.title,e<this.feedViewMaxRetries?(e++,this.previousTitle!==this.currentTitle&&""!==this.currentTitle?this.onIframeLoad():TRC.Timeout.set(this.checkIfNewTitleExist.trcBind(this,e),this.feedViewRetryInterval)):this.onIframeLoad()}listenToIframeLoad(){TRC.dom.on(this.iframe,"load",this.onLoad.trcBind(this)),TRC.dom.on(this.iframe.contentWindow,"DOMContentLoaded",this.onContentReady.trcBind(this))}onLoad(e){try{this.dispatchHook(o.FEED_VIEW_AFTER_IFRAME_LOADED),this.feedViewConfig.addUrlCheck&&this.checkUrlChange.interval&&this.stopIntervalUrlCheck(),this.checkIfCurrentParamsUpdated(e),this.onUnload=(()=>{this.container.scrollIntoView(),this.thirdPreviousTitle=this.previousTitle,this.previousTitle=this.iframe.contentDocument.title,this.checkIfNewTitleExist()}),TRC.dom.on(this.iframe.contentWindow,"unload",this.onUnload)}catch(e){__trcError("feedView - Error on onLoad ",e)}}onContentReady(){const e={eventType:"load start",sourcePlacement:this.rbox.unifiedPlacement,sourceItem_Id:this.item["item-id"]};this.trcManager.sendAbTestEvent("feedView_iframe_pv",e),this.isMobile&&this.setMobileContainerAndIframeHeight()}checkIfCurrentParamsUpdated(e){if(e.currentTarget.contentDocument&&(this.currentTitle=e.currentTarget.contentDocument.title,this.previousTitle!==this.currentTitle)){const t=e.currentTarget.contentDocument.URL;""===this.currentTitle&&(this.currentTitle=this.rbox.getPublisherBrandingName()||TRC.publisherId),this.title&&(this.title.innerText=TRC.text.htmlUnescape(this.currentTitle)),this.modifyPageHistory(this.currentTitle,t,null,"replaceState","feedView")}}animationEndHandler(t){if("feed-view-slide-bottom"===t.animationName){this.feedViewConfig.hideHeader||TRC.dom.removeClass(this.container,e.CONTAINER_SLIDE_IN),TRC.dom.off(this.iframe,"load",this.onLoad);const t=n.areUrlsOfSameOrigin(window.location,this.item.url);t&&this.iframe.contentWindow&&TRC.dom.off(this.iframe.contentWindow,"unload",this.onUnload),TRC.dom.removeClass(this.htmlElem,e.BODY_CONTAINER_CLASS),this.isMobile&&TRC.dom.removeClass(this.htmlElem,e.HIDDEN_ARTICLE),this.bodyElem.removeChild(this.container),this.itemContainer.scrollIntoView(this.feedViewConfig.useItemAtTopOfViewportReturnPosition)}"feed-view-slide-top"!==t.animationName||this.feedViewConfig.hideHeader||TRC.dom.removeClass(this.container,e.CONTAINER_SLIDE_IN)}static areUrlsOfSameOrigin(e,t){const i=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/,o=i.exec(t)||[],n={protocol:o[1]||"",host:o[2]||"",port:o[3]||""};function s(e){return{"http:":80,"https:":443}[e]}function r(t){return t.port||s(t.protocol||e.protocol)}return!!(n.protocol&&n.protocol===e.protocol&&n.host&&n.host===e.host&&n.host&&r(n).toString()===r(e).toString())}modifyPageHistory(e="",t,i=null,o,n){const{history:s}=window.top,r=new TRC.URL(t),a=i||{feedViewEventName:n};let l=r&&r.pathname;function d(e){const t=void 0!==this.feedViewConfig.addSearchToUrl?this.feedViewConfig.addSearchToUrl:this.trcManager.global["feed-view-add-search-to-url"];return e&&e.search&&t}d.call(this,r)&&(l+=r.search),s[o](a,e,l)}static removeIframe(t,i,o,s,r,a,l=!0,d=!1,h){!n.isFeedViewState()&&l||(i.className.indexOf(e.CONTAINER_SLIDE_OUT)<0&&-1===i.className.indexOf(e.FULL_MODE)&&TRC.dom.addClass(i,e.CONTAINER_SLIDE_OUT),d&&(TRC.dom.removeClass(document.documentElement,e.BODY_CONTAINER_CLASS),h&&TRC.dom.removeClass(document.documentElement,e.HIDDEN_ARTICLE),document.body.removeChild(i)))}static reportClick(e){try{if(TRCImpl.global["enable-feed-view-click-using-sendEvent"])TRCImpl.sendEvent("click",{ii:e["item-id"],it:e.type,feedView_click:"sendEvent"},null,!1);else{let t=new Image;t.onerror=function(){t=null},t.src=`${e.logger_url}&return_pixel=true&feedView_click=img`}}catch(e){__trcError("feedView - Error sending click event ",e)}}static createIframe(t){const i=.01*window.innerHeight;return`<iframe id="${e.IFRAME_ID}" name="${e.IFRAME_ID}" src="${t}" height="${i}"></iframe>`}static createIframeHeader(t){const i=`<div class="${e.HEADER_CLOSE_BUTTON}">\n                                <span class="tbl-close-btn-svg">${n.getCloseButtonMarkup()}</span>\n                              </div>`,o=`<span class="tbl-article-icon-svg">${n.getArticleIconMarkup()}</span>`,s=`<div class="${e.HEADER_TITLE}"></div>`,r=`<div id="${e.HEADER_ID}">\n                            ${t?`<div class="tbl-ios-header"></div>`:``}\n                            <div class="tbl-header-content">\n                                ${i}\n                                ${o}\n                                ${s}\n                            </div>\n                            </div>`;return r}static getCloseButtonMarkup(){return`<svg width="10px" height="10px" viewBox="0 0 10 10">\n                 <defs></defs>\n                 <g id="Page-1" stroke="none" stroke-width="1" fill-rule="evenodd">\n                   <g id="icons" transform="translate(-23.000000, -130.000000)">\n                      <polygon id="Desktop-Close-initial" points="33 131.208868 31.7911325 130 28 133.791132 24.2088675 130 23 131.208868 26.7911325 135 23 138.791132 24.2088675 140 28 136.208868 31.7911325 140 33 138.791132 29.2088675 135"></polygon>\n                   </g>\n                 </g>\n               </svg>`}static getArticleIconMarkup(){return`<svg width="13px" height="11px" viewBox="0 0 13 11">\n                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                        <g id="Group-2" fill="#154C91">\n                            <path d="M2.36684303,0 L2.36684303,6.1875 L0,6.1875 L0,8.9375 C0,10.10625 0.970987654,11 2.24074074,11 L10.3306878,11 C11.6004409,11 12.5714286,10.10625 12.5714286,8.9375 L12.5714286,0 L2.36684303,0 Z M10.9223986,8.9375 C10.9223986,9.35 10.5693122,9.625 10.0396825,9.625 L3.86067019,9.625 L3.86067019,1.375 L10.9223986,1.375 L10.9223986,8.9375 Z" id="Shape" fill-rule="nonzero" transform="translate(6.285714, 5.500000) scale(-1, 1) translate(-6.285714, -5.500000) "></path>\n                            <rect id="Rectangle" x="3.35238095" y="3.14285714" width="3.35238095" height="1.57142857"></rect>\n                            <rect id="Rectangle" x="3.35238095" y="6.28571429" width="3.35238095" height="1.57142857"></rect>\n                        </g>\n                    </g>\n                </svg>`}static getSelectors(){return e}static isFeedViewState(){return history.state&&history.state.feedViewEventName}}TRC.FeedView=n})();