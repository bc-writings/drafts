(function() {window.CONFIG_CSM_DOMAIN_NAME="csm.nl.eu.criteo.net"; window.CALLER_ID="72"; var CONFIG_JS_CALLBACK=TRC.getRTUS; var StorageOrigin,PrivateModeStatus,extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function __extends(e,t){function o(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function getCookie(e){for(var t=document.cookie.split(";"),o=0;o<t.length;o++){var n=t[o],r=n.substr(0,n.indexOf("=")).replace(/^\s+|\s+$/g,""),i=n.substr(n.indexOf("=")+1);if(r===e&&i)return decodeURIComponent(i)}return null}function setCookieOnMainDomain(e,t,o){var n=new Date;n.setTime(n.getTime()+60*o*60*1e3);for(var r="expires="+n.toUTCString(),i=document.location.hostname.split("."),a=null,s=0;s<i.length;++s){var u="domain=."+(a=i.slice(i.length-s-1,i.length).join("."));document.cookie=e+"="+encodeURIComponent(t)+";"+r+";"+u+";path=/";var l=getCookie(e);if(l&&l===t)break}return a||document.location}function deleteCookie(e){setCookieOnMainDomain(e,"",0)}function hasStorages(){return window.localStorage&&window.sessionStorage}function setItem(e,t){if(hasStorages())try{window.localStorage.setItem(e,t)}catch(e){}}function getItem(e){return hasStorages()?localStorage.getItem(e):null}function removeItem(e){if(hasStorages())return localStorage.removeItem(e)}function getFromAllStorages(e,t){var o=getCookie(e),n=getItem(e);return o||n?t(o||n,(o&&StorageOrigin.Cookie)|(n&&StorageOrigin.LocalStorage)):t(null,StorageOrigin.None)}!function(e){e[e.None=0]="None",e[e.Cookie=1]="Cookie",e[e.LocalStorage=2]="LocalStorage",e[e.Delegation=4]="Delegation"}(StorageOrigin=StorageOrigin||{}),function(e){e[e.Unknown=0]="Unknown",e[e.Deactivated=1]="Deactivated",e[e.Activated=2]="Activated"}(PrivateModeStatus=PrivateModeStatus||{});var StorableUserData=function(){function e(e,t,o,n){this.storageKey=e,this.expirationTimeHours=t,this.value=o,this.origin=n}return e.prototype.hasValue=function(){return""!==String(this.value)&&null!==this.value&&void 0!==this.value},e.prototype.saveOnAllStorages=function(){if(this.hasValue()){var e="boolean"==typeof this.value?this.value?"1":"0":String(this.value);setCookieOnMainDomain(this.storageKey,e,this.expirationTimeHours),setItem(this.storageKey,e)}},e.prototype.toJSON=function(){return{value:this.value,origin:this.origin}},e.prototype.removeFromAllStorages=function(){deleteCookie(this.storageKey),removeItem(this.storageKey)},e.prototype.fromAllStorages=function(e){return getFromAllStorages(this.storageKey,e)},e}(),Sid=function(o){function n(e,t){return o.call(this,"cto_sid",9360,e,t)||this}return __extends(n,o),n.fromAllStorages=function(){return getFromAllStorages("cto_sid",function(e,t){return new n(e,t)})},n.fromValue=function(e){return new n(e,StorageOrigin.None)},n}(StorableUserData),IdCopy=function(o){function n(e,t){return o.call(this,"cto_idcpy",9360,e,t)||this}return __extends(n,o),n.fromAllStorages=function(){return getFromAllStorages("cto_idcpy",function(e,t){return new n(e,t)})},n.fromValue=function(e){return new n(e,StorageOrigin.None)},n}(StorableUserData),LocalWebId=function(o){function n(e,t){return o.call(this,"cto_lwid",9360,e,t)||this}return __extends(n,o),n.fromAllStorages=function(){return getFromAllStorages("cto_lwid",function(e,t){return new n(e,t)})},n.fromValue=function(e){return new n(e,StorageOrigin.None)},n}(StorableUserData),Optout=function(o){function n(e,t){return o.call(this,"cto_optout",43200,e,t)||this}return __extends(n,o),n.fromAllStorages=function(){return getFromAllStorages("cto_optout",function(e,t){return new n("1"===e,t)})},n.fromValue=function(e){return new n(e,StorageOrigin.None)},n}(StorableUserData),Bundle=function(o){function n(e,t){return o.call(this,"cto_bundle",9360,e,t)||this}return __extends(n,o),n.fromAllStorages=function(){return getFromAllStorages("cto_bundle",function(e,t){return new n(e,t)})},n.fromValue=function(e){return new n(e,StorageOrigin.None)},n}(StorableUserData),eventQueue=[],SYNCFRAME_ID="criteo-syncframe",SYNCFRAME_URL="https://gum.criteo.com/syncframe",idcpy=IdCopy.fromAllStorages(),optout=Optout.fromAllStorages(),sid=Sid.fromAllStorages(),lwid=LocalWebId.fromAllStorages(),bundle=Bundle.fromAllStorages(),cookiesWriteable=!1,hasFetchAPI="function"==typeof window.fetch,rtusResponseFromLocalStorage=null,FETCHED_CALLED=!1,CURRENT_SCRIPT_SRC=document.currentScript.src,RTUS_RESPONSE_LS_KEY="cto_rtus",RTUS_RESPONSE_LS_KEY_WITH_CALLERID=RTUS_RESPONSE_LS_KEY+"_"+window.CALLER_ID,JSON_DELIMITER_REGEX=/\(({[^}]*})\)/g,JS_CALLBACK=CONFIG_JS_CALLBACK||function(e){},DEFAULT_RTUS_RESPONSE={status:"Unknown",userid:""},syncframeListener=function(e){var t=e.data;t&&t.isCriteoMessage&&hasFetchAPI&&(e.stopImmediatePropagation(),t.optout?(logCounter("Origin.FromSyncframeOptout"),sid.removeFromAllStorages(),idcpy.removeFromAllStorages(),(optout=Optout.fromValue(!0)).saveOnAllStorages(),bundle.removeFromAllStorages(),fetchGumResponseAndStoreItInLocalStorage(null,optout,null,null)):(t.uid&&(logCounter("Origin.FromSyncframeIdcpy"),IdCopy.fromValue(t.uid).saveOnAllStorages()),t.bundle&&(logCounter("Origin.FromSyncframeBundle"),Bundle.fromValue(t.bundle).saveOnAllStorages()),t.removeSid?(logCounter("Origin.FromSyncframeRemoveSid"),sid.removeFromAllStorages(),removeItem(RTUS_RESPONSE_LS_KEY),removeItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID)):t.sid&&(logCounter("Origin.FromSyncframeSid"),Sid.fromValue(t.sid).saveOnAllStorages()),t.sid||t.uid||t.bundle?fetchGumResponseAndStoreItInLocalStorage(Sid.fromValue(t.sid),Optout.fromValue(!1),IdCopy.fromValue(t.uid),Bundle.fromValue(t.bundle)):sendMetrics()))};function fetchGumResponseAndStoreItInLocalStorage(e,t,o,n){if(FETCHED_CALLED)sendMetrics();else{var r=new Headers;e&&e.hasValue()&&(r.set("X-CRTO-SID",e.value),logCounter("Headers.Sid")),t&&t.value&&(r.set("X-CRTO-OPTOUT","1"),logCounter("Headers.Optout")),o&&o.hasValue()&&(r.set("X-CRTO-IDCPY",o.value),logCounter("Headers.Idpcy")),n&&n.hasValue()&&(r.set("X-CRTO-BUNDLE",n.value),logCounter("Headers.Bundle")),logCounter("Events.InitiateFetch"),fetch(CURRENT_SCRIPT_SRC,{headers:r,cache:"reload",mode:"cors"}).then(function(e){return e.text().then(function(e){if(FETCHED_CALLED=!0,!(0<e.indexOf('"status":"Unknown"'))){var t=JSON_DELIMITER_REGEX.exec(e);t&&t[1]&&(setItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID,t[1]),logCounter("Events.SaveResponseOnLocalStorage")),sendMetrics()}})}).catch(logCounter.bind(null,"Events.FetchError")).then(sendMetrics)}}function parseJSON(e){try{return JSON.parse(e)}catch(e){return logCounter("Events.JsonParseError"),{}}}function getTld(){var e=setCookieOnMainDomain("cto_tld_test","test",1);return deleteCookie("cto_tld_test"),e}function canWriteCookies(){setCookieOnMainDomain("cto_write_test","testWrite",1);var e="testWrite"===getCookie("cto_write_test");return deleteCookie("cto_write_test"),e}function createGumIframe(){var e=document.createElement("iframe"),t=extractHostname(getHighestAccessibleUrl(getHighestAccessibleWindow(window))),o=encodeURIComponent(t),n=getTld(),r={sid:sid.toJSON(),uid:idcpy.toJSON(),optout:optout.toJSON(),bundle:bundle.toJSON(),lwid:lwid.toJSON(),tld:n,cw:cookiesWriteable,origin:"rtus",topUrl:o,rtusCallerId:parseInt(window.CALLER_ID,10)};return e.src=SYNCFRAME_URL+(o?"?topUrl="+o:"")+"#"+JSON.stringify(r),e.id=SYNCFRAME_ID,e.width="0",e.height="0",e.frameBorder="0",e.setAttribute("style","border-width:0px; margin:0px; display:none"),e}function shouldDropSyncframe(){return!document.getElementById(SYNCFRAME_ID)}function appendGumIframeIfDoesNotExist(){shouldDropSyncframe()&&(logCounter("Events.SyncframeDropped"),window.addEventListener("message",syncframeListener,!0),document.body.appendChild(createGumIframe()))}function extractHostname(e){var t=document.createElement("a");return t.href=e,t.hostname}function getHighestAccessibleUrl(e){var t=e.topFrame,o="";if(e.err)try{try{o=t.top.location.href}catch(e){var n=t.location.ancestorOrigins;o=n[n.length-1]}}catch(e){o=t.document.referrer}else o=t.location.href;return o}function getHighestAccessibleWindow(e){var t=e,o=!1;try{for(;t.parent.document!==t.document;){if(!t.parent.document){o=!0;break}t=t.parent}}catch(e){o=!0}return{topFrame:t,err:o}}function init(){if(logCounter("Events.StartInit"),sid=Sid.fromAllStorages(),optout=Optout.fromAllStorages(),lwid=LocalWebId.fromAllStorages(),idcpy=IdCopy.fromAllStorages(),bundle=Bundle.fromAllStorages(),cookiesWriteable=canWriteCookies(),lwid.hasValue()&&logCounter("Origin.FromLocalWebId"),window.addEventListener)if("complete"===document.readyState)appendGumIframeIfDoesNotExist();else{var e=function(){window.removeEventListener("load",e),document.removeEventListener("DOMContentLoaded",e),appendGumIframeIfDoesNotExist()};window.addEventListener("load",e,!1),document.addEventListener("DOMContentLoaded",e,!1)}if(rtusResponseFromLocalStorage=getItem(RTUS_RESPONSE_LS_KEY_WITH_CALLERID)||getItem(RTUS_RESPONSE_LS_KEY))return JS_CALLBACK(parseJSON(rtusResponseFromLocalStorage)),logCounter("Origin.FromLocalRtusResponse"),void sendMetrics();(sid.hasValue()||optout.value||idcpy.hasValue()||bundle.hasValue())&&(sid.hasValue()&&logCounter("Origin.FromLocalSid"),optout.value&&logCounter("Origin.FromLocalOptout"),idcpy.hasValue()&&logCounter("Origin.FromIdCpy"),bundle.hasValue()&&logCounter("Origin.FromBundle"),fetchGumResponseAndStoreItInLocalStorage(sid,optout,idcpy,bundle)),JS_CALLBACK(DEFAULT_RTUS_RESPONSE)}function logCounter(e){eventQueue.push("entry=c~Idfs.Rtus."+(window.CALLER_ID||"UnknownCaller")+"."+e+"~1")}function sendMetrics(){if(0!==eventQueue.length){var e=eventQueue.join("&"),t="https://"+window.CONFIG_CSM_DOMAIN_NAME+"/iev?"+e;if(!window.CONFIG_CSM_DOMAIN_NAME)return console.log("Pixel",t);(new Image).src=t,eventQueue=[]}}init();
})();