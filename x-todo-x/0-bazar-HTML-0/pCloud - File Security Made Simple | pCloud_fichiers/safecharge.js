/*v1.7.1	 	rev #675a594, built on 2020-11-17 16:01:15*/String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(a,b){return b=!b||b<0?0:+b,this.substring(b,b+a.length)===a}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){"use strict";if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0}),"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(a,b){b=b||window;for(var c=0;c<this.length;c++)a.call(b,this[c],c,this)}),"function"!=typeof Object.assign&&(Object.assign=function(a,b){"use strict";if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c}),Array.prototype.find||(Array.prototype.find=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b}),function(){for(var a=["DocumentType","Element","CharacterData"],b=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},c=0;c<a.length;c++){var d=a[c];window[d]&&!window[d].prototype.remove&&(window[d].prototype.remove=b)}}(),function(a,b,c){a[b]=c()}(this,"ulog",function(){"use strict";function a(c){return c?l[c]?l[c]:l[c]=b({name:c},a):a.debug?a:b(a)}function b(a,b,f){a.NONE=0;for(var g in j)a[g]=j[g];return Object.defineProperty(a,"level",{get:function(){return void 0!==f?f:b&&b.level},set:function(d){if(void 0===d&&b)f=void 0;else{var e=d&&(Number(d)!==Number(d)?a[d.toUpperCase()]:Number(d));e>=0&&e<=6&&(f=e)}if(c(a),!b)for(mod in l)c(l[mod])}}),c(a,b),a.dir=d("dir")||e,a.table=d("table")||e,a.time=d("time")||e,a.timeEnd=d("timeEnd")||e,a.assert="object"==typeof window&&d("assert")||function(){var b=[].concat.apply([],arguments);b.shift()||a.error.apply(a,b)},a}function c(b){for(var c,f=Math.max(b.name&&a.enabled(b.name)&&b.DEBUG||b.level,b.level),g=0;c=k[g];g++)b[c]=f<=g?e:d(c)||"function"==typeof print&&print||e}function d(b,c){return(c=a.con())&&(c[b]||c.log).bind(c)}function e(){}a.ulog={version:"1.1.0"},a.enable=function(a){var b,d=(a||"").split(/[\s,]+/);for(b=0;b<d.length;b++)d[b]&&(a=d[b].replace(/\*/g,".*?"),"-"===a[0]?n.push(new RegExp("^"+a.substr(1)+"$")):m.push(new RegExp("^"+a+"$")));for(b in l)c(l[b])},a.enabled=function(a){var b;for(b=0;b<n.length;b++)if(n[b].test(a))return;for(b=0;b<m.length;b++)if(m[b].test(a))return!0},a.disable=a.enable.bind(a,"");var f,g,h,i,j={ERROR:1,WARN:2,INFO:3,LOG:4,DEBUG:5,TRACE:6},k=Object.keys(j).map(function(a){return a.toLowerCase()}),l={},m=[],n=[],o=location.search.substring(1),p=o&&o.split("&");try{f=localStorage.getItem("log"),g=localStorage.getItem("debug")}catch(r){}for(h=0;i=p&&p[h]&&p[h].split("=");h++)"log"==i[0]&&(f=i[1]),"debug"==i[0]&&(g=i[1]);a.con=function(){return window.console&&console},g&&a.enable(g);var q=a();return a.level=f||a.WARN,q});var UUIDjs=function(){"use strict";function a(){}return a.maxFromBits=function(a){return Math.pow(2,a)},a.limitUI04=a.maxFromBits(4),a.limitUI06=a.maxFromBits(6),a.limitUI08=a.maxFromBits(8),a.limitUI12=a.maxFromBits(12),a.limitUI14=a.maxFromBits(14),a.limitUI16=a.maxFromBits(16),a.limitUI32=a.maxFromBits(32),a.limitUI40=a.maxFromBits(40),a.limitUI48=a.maxFromBits(48),a.randomUI04=function(){return Math.round(Math.random()*a.limitUI04)},a.randomUI06=function(){return Math.round(Math.random()*a.limitUI06)},a.randomUI08=function(){return Math.round(Math.random()*a.limitUI08)},a.randomUI12=function(){return Math.round(Math.random()*a.limitUI12)},a.randomUI14=function(){return Math.round(Math.random()*a.limitUI14)},a.randomUI16=function(){return Math.round(Math.random()*a.limitUI16)},a.randomUI32=function(){return Math.round(Math.random()*a.limitUI32)},a.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},a.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},a.paddedString=function(a,b,c){a=String(a),c=c||"0";var d=b-a.length;for(d;d>0;d>>>=1,c+=c)1&d&&(a=c+a);return a},a.prototype.fromParts=function(b,c,d,e,f,g){return this.version=d>>12&15,this.hex=a.paddedString(b.toString(16),8)+"-"+a.paddedString(c.toString(16),4)+"-"+a.paddedString(d.toString(16),4)+"-"+a.paddedString(e.toString(16),2)+a.paddedString(f.toString(16),2)+"-"+a.paddedString(g.toString(16),12),this},a.prototype.toString=function(){return this.hex},a.prototype.toURN=function(){return"urn:uuid:"+this.hex},a.prototype.toBytes=function(){var a=this.hex.split("-"),b=[],c=0,d=0;for(d;d<a.length;d++){var e=0;for(e;e<a[d].length;e+=2)b[c++]=parseInt(a[d].substr(e,2),16)}return b},a.prototype.equals=function(a){return a instanceof UUID&&this.hex===a.hex},a.getTimeFieldValues=function(a){var b=a-Date.UTC(1582,9,15),c=b/4294967296*1e4&268435455;return{low:1e4*(268435455&b)%4294967296,mid:65535&c,hi:c>>>16,timestamp:b}},a._create4=function(){return(new a).fromParts(a.randomUI32(),a.randomUI16(),16384|a.randomUI12(),128|a.randomUI06(),a.randomUI08(),a.randomUI48())},a._create1=function(){var b=(new Date).getTime(),c=a.randomUI14(),d=1099511627776*(1|a.randomUI08())+a.randomUI40(),e=a.randomUI04(),f=0;b!==f?(b<f&&c++,f=b,e=a.randomUI04()):Math.random()<.25&&e<9984?e+=1+a.randomUI04():c++;var g=a.getTimeFieldValues(f),h=g.low+e,i=4095&g.hi|4096;c&=16383;var j=c>>>8|128,k=255&c;return(new a).fromParts(h,g.mid,i,j,k,d)},a.create=function(a){return a=a||4,this["_create"+a]()},a.fromTime=function(b,c){c=c||!1;var d=a.getTimeFieldValues(b),e=d.low,f=4095&d.hi|4096;return!1===c?(new a).fromParts(e,d.mid,f,0,0,0):(new a).fromParts(e,d.mid,f,128|a.limitUI06,a.limitUI08-1,a.limitUI48-1)},a.firstFromTime=function(b){return a.fromTime(b,!1)},a.lastFromTime=function(b){return a.fromTime(b,!0)},a.fromURN=function(b){var c;return c===/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i.exec(b)?(new a).fromParts(parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),parseInt(c[4],16),parseInt(c[5],16),parseInt(c[6],16)):null},a.fromBytes=function(b){var c="",d=0,e=[4,2,2,2,6],f=0;if(b.length<5)return null;for(f;f<e.length;f++){var g=0;for(g;g<e[f];g++){var h=b[d++].toString(16);1===h.length&&(h="0"+h),c+=h}6!==e[f]&&(c+="-")}return a.fromURN(c)},a.fromBinary=function(b){var c=[],d=0;for(d;d<b.length;d++)if(c[d]=b.charCodeAt(d),c[d]>255||c[d]<0)throw new Error("Unexpected byte in binary data.");return a.fromBytes(c)},a}();!function(a){function b(){for(var a=0;a<document.scripts.length;a++){var b=document.scripts[a],c=b.src.lastIndexOf("/safecharge.js");if(c>-1)return b.src.substr(0,c+1)}}function c(a,b){n.info("---\x3e paymentFrame \n"+JSON.stringify(a,null,4)),n.trace("---\x3e paymentFrame \n"),p=a.paymentOption,q=a.transactionId,i(),document.querySelector("a.sfcIcon--close.sfcModal-close").addEventListener("click",function(){document.getElementById(s).classList.remove("is-in"),setTimeout(function(){document.getElementById(s).style.display="none",g()},300),b({cancelled:!0})},{once:!0}),t||(window.addEventListener("message",function(c){var d={};try{d=JSON.parse(c.data)}catch(e){}d.threeDLoad&&ifrm.contentWindow.postMessage(JSON.stringify(p),"*"),n.info("---\x3e Auth 3ds data \n"+JSON.stringify(d,null,4)),n.trace("---\x3e Auth 3ds data \n"),d.paRes&&(document.getElementById(s).classList.remove("is-in"),setTimeout(function(){document.getElementById(s).style.display="none",g()},300),d.cancelled=!1,"ERROR"===d.result&&""===d.errorDescription&&""===d.errCode&&""===d.transactionId||"1058"===iframeDaxta.errCode||"Requested operation can not be performed on this order"===d.reason?r(a.all.server,a.sessionToken,b):b(d)),(d.result||""===d.result||d.transactionId||"-5"===d.errCode)&&(document.getElementById(s).classList.remove("is-in"),setTimeout(function(){document.getElementById(s).style.display="none",g()},300),d.cancelled=!1,"authenticate3d"===a.all.sourceMethod&&(d.transactionId=q),"ERROR"===d.result&&""===d.errorDescription&&""===d.errCode&&""===d.transactionId||"1058"===d.errCode||"Requested operation can not be performed on this order"===d.reason?r(a.all.server,a.sessionToken,b):b(d))}),t=!0)}function d(a,b,c){b[a]&&b[a].forEach(function(a){a.call(c,c)})}function e(a,b,c){this.field=a.field,a.type&&(a.type="_"+a.type),a.targetHost={local:"https://dev-mobile.safecharge.com",test:"https://cdn-int.safecharge.com",prod:"https://cdn.safecharge.com"}[a.env||"prod"],this._type=a.type||"",this.options=a,this.fieldsOptions=c,this.uuid=b,this.subs={},this.frameElm=null,this.initialParentClasses="",this._state={destroyed:!1},this.stateClass={focus:"sfc-focus",empty:"sfc-empty",invalid:"sfc-invalid",complete:"sfc-complete"},this.options.classes&&Object.assign(this.stateClass,this.options.classes),this.peers={}}function f(a){this.config=a,this.config.faction=UUIDjs.create().toString(),this.instances=[]}function g(){document.getElementsByName(this.iframeName)[0].remove(),document.getElementById(s).remove()}function h(){var a=document.createElement("div");a.id="o"+UUIDjs.create(1).hex,s=a.id,a.node="dialog",a.style="display: display; overflow: auto; position: fixed; z-index: 9999; outline: 0px; background-color: rgba(210, 204, 204, 0.5); top: 0px; right: 0px; left: 0px; bottom: 0px;",a.innerHTML='<div class="sfcModal-dialog">\n        <div class="sfcModal-content" style="position:relative;background-color:#fff;background-clip:padding-box;outline:0;border:1px solid #dfdfdf;">\n            <div class="sfcModal-header">\n                <a role="button" data-dismiss="modal" aria-label="Close" class="sfcIcon--close sfcModal-close"></a>\n            </div>\n            <div class="sfcModal-body" style="-webkit-overflow-scrolling: touch;">\n            </div>\n        </div>\n    </div>',document.body.appendChild(a)}function i(){h(),document.getElementById(s).style.display="block",setTimeout(function(){document.getElementById(s).classList.add("is-in")},300);var a=document.createElement("iframe");this.iframeName="i."+UUIDjs.create().hex,a.setAttribute("id","ifrm"),a.style="height: 420px;border: none !important; margin: 0 !important;padding: 0 !important;width: 1px !important;min-width: 100% !important;overflow: hidden !important;display: block !important;",a.setAttribute("name",iframeName),a.setAttribute("src",b()+"preloader.html?"+(new Date).getTime());var c=document.getElementsByClassName("sfcModal-body")[0];c.appendChild(a)}var j={},k=null,l={},m={},n=ulog("safeCharge"),o="",p=null,q=null,r=function(a,b,c){var d=new XMLHttpRequest,e=a+"/ppp/api/v1/getPaymentStatus.do";d.open("POST",e,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.timeout=3e4,d.onload=function(){if(200===d.status){var a=JSON.parse(d.response);a.paymentOption=a.paymentOption||{},a.paymentOption.card=a.paymentOption.card||{};var b={result:a.transactionStatus||a.status,errCode:a.gwExtendedErrorCode||a.gwErrorCode||a.paymentMethodErrorCode||a.errorCode||a.errCode||"0",errorDescription:a.gwErrorReason||a.paymentMethodErrorReason||a.errorDescription||a.reason||"",userPaymentOptionId:a.paymentOption.userPaymentOptionId,ccCardNumber:a.paymentOption.card.ccCardNumber||"",bin:a.paymentOption.card.bin||"",last4Digits:a.paymentOption.card.last4Digits||"",ccExpMonth:a.paymentOption.card.ccExpMonth||"",ccExpYear:a.paymentOption.card.ccExpYear||"",transactionId:a.transactionId,multipleRequests:!0,cancelled:!1};c(b)}},d.send(JSON.stringify({sessionToken:b}))};window.addEventListener("message",function(a){var b={};try{b=JSON.parse(a.data)}catch(q){}if(k&&"tokenize-result"===b.event){n.info("---\x3e "+b.event+"\n"+JSON.stringify(b,null,4)),n.trace("---\x3e "+b.event+"\n");var e=b.message.payload.data;if(e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&e.paymentOption.card.threeD.v2supported&&"true"===e.paymentOption.card.threeD.v2supported){var f=e.paymentOption.card.threeD;e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},e.paymentOption.card.threeD=e.paymentOption.card.threeD||{},f.methodUrl||(e.paymentOption.card.threeD.methodCompletionInd="U",k(e)),f.methodUrl&&f.methodPayload&&u(f.methodUrl,f.methodPayload,function(a){e.paymentOption.card.threeD.methodCompletionInd=a,k(e)})}else k(b.message.payload.data)}if("init-payment-threeDVersion"===b.event&&(n.info("---\x3e "+b.event+"\n"+JSON.stringify(b,null,4)),n.trace("---\x3e "+b.event+"\n"),o=b.message.payload.data),k&&"make-payment-result"===b.event){n.info("---\x3e "+b.event+"\n"+JSON.stringify(b,null,4)),n.trace("---\x3e "+b.event+"\n");var g=b.message.payload.data;if(g.paymentOption&&g.paymentOption.card&&g.paymentOption.card.threeD&&g.paymentOption.card.threeD.acsUrl&&(g.paymentOption.card.threeD.paRequest||g.paymentOption.card.threeD.cReq))g.paymentOption.card.threeD.paRequest&&(g.all.sourceMethod&&"createPayment"===g.all.sourceMethod?g.paymentOption.card.threeD.termUrl=g.all.server+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+g.sessionToken:g.all.sourceMethod&&"authenticate3d"===g.all.sourceMethod&&(g.paymentOption.card.threeD.termUrl=g.all.server+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+g.sessionToken)),c(g,function(a){k(a)});else{var h;h=void 0===g.error?{}:g.error,g.paymentOption=g.paymentOption||{},g.paymentOption.card=g.paymentOption.card||{},g.paymentOption.card.threeD=g.paymentOption.card.threeD||{};var i={result:g.transactionStatus||g.status||"ERROR",errCode:g.gwExtendedErrorCode||g.gwErrorCode||g.paymentMethodErrorCode||g.errorCode||h.code||g.errCode||"0",errorDescription:g.gwErrorReason||g.paymentMethodErrorReason||g.errorDescription||h.message||"",userPaymentOptionId:g.paymentOption.userPaymentOptionId||"",cavv:g.paymentOption.card.threeD.cavv||"",eci:g.paymentOption.card.threeD.eci||"",xid:g.paymentOption.card.threeD.xid||"",dsTransID:g.paymentOption.card.threeD.dsTransID||"",ccCardNumber:g.paymentOption.card.ccCardNumber||"",bin:g.paymentOption.card.bin||"",last4Digits:g.paymentOption.card.last4Digits||"",ccExpMonth:g.paymentOption.card.ccExpMonth||"",ccExpYear:g.paymentOption.card.ccExpYear||"",transactionId:g.transactionId,cancelled:!1,transactionStatus:g.transactionStatus,transactionType:g.transactionType};k(i)}}if("change"===b.event&&l[b.source]){var j=l[b.source].stateClass.focus,m=l[b.source].stateClass.empty,p=l[b.source].stateClass.complete;b.message.payload.empty?l[b.source].parentElm.classList.add(m):l[b.source].parentElm.classList.remove(m),b.message.payload.complete?l[b.source].parentElm.classList.add(p):l[b.source].parentElm.classList.remove(p),d("change",l[b.source].subs,Object.assign({field:l[b.source].field},b.message.payload))}"focus"===b.event&&l[b.source]&&(j=l[b.source].stateClass.focus,l[b.source].parentElm.classList.add(j),d(b.event,l[b.source].subs,{field:l[b.source].field})),"blur"===b.event&&l[b.source]&&(j=l[b.source].stateClass.focus,l[b.source].parentElm.classList.remove(j),d(b.event,l[b.source].subs,{field:l[b.source].field})),"load"===b.event&&l[b.source]&&l[b.source]._init(),"ready"===b.event&&(l[b.source]&&("_card"===l[b.source]._type&&b.message.payload.support19Digits&&(l[b.source].frameElm.contentWindow.document.getElementsByClassName("Input")[0].dataset.max="9878 9878 9878 9878 9870 987"),0!==b.message.payload.height?l[b.source].frameElm.style.height=b.message.payload.height+"px":b.message.payload.data&&b.message.payload.data.style&&b.message.payload.data.style.base&&b.message.payload.data.style.base.fontSize&&(l[b.source].frameElm.style.height=b.message.payload.fontSize.style.base.fontSize),l[b.source].sendPeers()),d(b.event,l[b.source].subs,{field:l[b.source].field}))},!1),e.prototype._sendMsg=function(a){"input-focus"!==a.action&&(n.info("---\x3e LOG "+a.action+"\n"+JSON.stringify(a,null,4)),n.trace("--\x3e TRACE "+a.action+" \n")),a.type="td",a.source=this.uuid;var c=document.createElement("A");c.href=b();var d=c.protocol+"//"+c.host;this.frameElm.contentWindow.postMessage(JSON.stringify(a),d)},e.prototype.sendPeers=function(){this._sendMsg({action:"add-member",payload:this.peers,origin:document.location.origin})},e.prototype._check=function(){if(this._state.destroyed)throw"The element has already been destroyed"},e.prototype._init=function(){this._check(),this._sendMsg({action:"init-field",support19Digits:support19Digits,payload:this.options,fieldsConfig:this.fieldsOptions,origin:document.location.origin})},e.prototype.addMember=function(a){this.peers[a.type]=a.id},e.prototype.focus=function(){this._check(),this._sendMsg({action:"input-focus",source:this.uuid})},e.prototype.clear=function(){this._check(),this._sendMsg({action:"input-clear",source:this.uuid})},e.prototype.__tokenize=function(a,b,c){k=c,this._check(),this._sendMsg({extraData:b,action:"input-tokenize",sessionToken:a.sessionToken,merchantSiteId:a.merchantSiteId,env:a.env})},e.prototype.__makePayment=function(a,b,c){if(k=c,b.paymentOption.userPaymentOptionId){var d=b.paymentOption.userPaymentOptionId,e=b.paymentOption.card.expirationMonth,f=b.paymentOption.card.expirationYear;b.paymentOption={},b.paymentOption.card={},b.paymentOption.userPaymentOptionId=d,b.paymentOption.card.expirationMonth=e,b.paymentOption.card.expirationYear=f}else b.paymentOption={};this._check(),this._sendMsg({extraData:b,action:"input-make-payment",sessionToken:a.sessionToken||b.sessionToken,merchantSiteId:a.merchantSiteId,merchantId:a.merchantId,env:a.env,all:a})},e.prototype.destroy=function(){this._check(),this._state.destroyed=!0,this.parentElm.innerHTML="",this.parentElm.className=this.initialParentClasses},e.prototype.attach=function(a){"string"==typeof a&&(a=document.querySelector(a)),this.parentElm=a;for(var c=a.nextElementSibling;c;){var d=this;"LABEL"===c.tagName&&c.addEventListener("click",function(){d.focus()}),c=c.nextElementSibling}this.initialParentClasses=a.classList.value,a.classList.add("SfcField"),a.classList.add(this.stateClass.empty);var e=document.createElement("div");e.setAttribute("style","margin:0 !important; padding:0 !important;border:none !important;display:block !important;background:transparent !important;position:relative !important;opacity:1 !important;");var f=document.createElement("iframe");f.frameborder="0",f.allowtransparency="true",f.scrolling="no",f.name=this.uuid,f.allowpaymentrequest="true",f.src=b()+"sfc_inner"+this._type+".html?v1.7.1",f.title="SFC secure field",a.appendChild(e),f.setAttribute("style","border:none !important;margin:0 !important;padding:0 !important;width:1px !important;min-width:100% !important;overflow:hidden !important;display:block !important;height:0;"),f.setAttribute("id",this._type),this.frameElm=f,e.appendChild(f)},e.prototype.on=function(a,b){["blur","change","focus","ready"].indexOf(a)>-1&&b&&"function"==typeof b&&(this.subs[a]||(this.subs[a]=[]),this.subs[a].push(b))},f.prototype.create=function(a,b){if("card"!==a&&"ccNumber"!==a&&"ccExpiration"!==a&&"ccCvc"!==a)throw"A valid Element name must be provided. Valid Elements is card\nyou requested: "+a+".";var c=UUIDjs.create().toString();return"card"!==a&&(b.type={ccNumber:"card",ccExpiration:"exp",ccCvc:"cvc"}[a]),b.field=a,b.env=j.env,l[c]=new e(b,c,this.config),this.instances.length&&this.instances.forEach(function(b){b.instance.addMember({type:a,id:c})}),this.instances.push({type:a,instance:l[c]}),l[c]};var s="o2087c6f6-7865-11e9-9143-116d91954306",t=!1,u=function(a,b,c){var d=document.createElement("form");d.style.display="none",d.id="u"+UUIDjs.create(1).hex;var e=document.createElement("iframe");e.style.display="none",e.name="i"+UUIDjs.create(1).hex;var f=document.createElement("input");document.body.appendChild(e),d.method="POST",d.action=a,d.target=e.name,f.value=b,f.name="threeDSMethodData",d.appendChild(f),document.body.appendChild(d);var g={};try{g=JSON.parse(atob(b))}catch(k){}var h=g.threeDSServerTransID;d.submit();var i=setTimeout(function(){window.removeEventListener("message",j,!1),c("N")},15050),j=function(a){clearTimeout(i),window.removeEventListener("message",j,!1);var b={};if(document.getElementsByName(e.name)[0].remove(),a.data)try{if(b=JSON.parse(a.data),2===b.response.split("=").length){var d=atob(b.response.split("=")[1]),f={threeDSServerTransID:!1};try{f=JSON.parse(d)}catch(k){return c("N")}return c(f.threeDSServerTransID&&f.threeDSServerTransID===h?"Y":"N")}return c("N")}catch(k){return c("N")}};window.addEventListener("message",j,{once:!0}),document.getElementById(d.id).remove()},v={parseResult:function(a){var b={};try{b=JSON.parse(a)}catch(c){b={error:{type:"network",code:"invalid response",message:"SafeCharge Server returned invalid response"}}}return b}};a.SafeCharge=function(a){a=a||{},j.sessionToken=a.sessionToken,j.env=a.env||"prod",j.merchantSiteId=a.merchantSiteId,j.merchantId=a.merchantId,j.sourceApplication=a.sourceApplication,j.safeChargeLog=a.safeChargeLog||"NONE",support19Digits=a.support19Digits||!1,n.level=n[j.safeChargeLog];var b={prod:"https://secure.safecharge.com",int:"https://ppp-test.safecharge.com",test:"https://ppp-test.safecharge.com",qa:"https://apmtest.gate2shop.com",dev:"https://dev-mobile.safecharge.com",local:"https://dev-mobile.safecharge.com"}[j.env||"prod"];return j.server=b,{fields:function(a){return new f(a)},authenticate3d:function(a,c){if(!0===m.isProcessing)return void c({processingOrder:!0});if(m.isProcessing=!0,a.paymentOption.card){var d=JSON.parse(JSON.stringify(a));d.paymentOption.card.cardNumber="**** **** **** ****",d.paymentOption.card.expirationMonth="**",d.paymentOption.card.expirationYear="**",d.paymentOption.card.CVV="***",n.info("---\x3e authenticate3d input object\n"+JSON.stringify(d,null,4)),n.trace("---\x3e TRACE authenticate3d \n")}else n.info("---\x3e authenticate3d input object\n"+JSON.stringify(a,null,4)),n.trace("---\x3e TRACE authenticate3d \n");if(!a.merchantSiteId&&j.merchantSiteId&&(a.merchantSiteId=j.merchantSiteId),!a.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!a.merchantId&&j.merchantId&&(a.merchantId=j.merchantId),!a.merchantId)throw new Error("Merchant id is mandatory.");var e=this,f=function(d){return m={},d.errCode&&1058===d.errCode?r(b,a.sessionToken,c):d},g=function(a,c){var d=new XMLHttpRequest,g=b+"/ppp/api/v1/clientAuthorize3d.do";d.open("POST",g,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.timeout=3e4,d.onload=function(){if(200===d.status){var a=v.parseResult(d.responseText);if(void 0===a.all&&(a.all={}),a.all.sourceMethod="authenticate3d",a.all.server=b,"ERROR"===a.status)a.error={type:"card",code:a.errCode},a.error.message=a.reason||"Process failed.",c(f(a));else if("SUCCESS"===a.status)if(a.paymentOption&&a.paymentOption.card&&a.paymentOption.card.threeD&&a.paymentOption.card.threeD.acsUrl&&(a.paymentOption.card.threeD.paRequest||a.paymentOption.card.threeD.cReq))a.paymentOption.card.threeD.paRequest&&(a.paymentOption.card.threeD.termUrl=b+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+a.sessionToken),e.paymentFrame(a,function(a){a.threeDVersion=e.tempData.paymentOption.card.threeD.version||"",c(f(a))});else{a.paymentOption=a.paymentOption||{},a.paymentOption.card=a.paymentOption.card||{},a.paymentOption.card.threeD=a.paymentOption.card.threeD||{};var g={result:a.transactionStatus,errCode:a.gwExtendedErrorCode||a.gwErrorCode||a.paymentMethodErrorCode||a.errorCode||"0",errorDescription:a.gwErrorReason||a.paymentMethodErrorReason||a.errorDescription||"",userPaymentOptionId:a.paymentOption.userPaymentOptionId||"",cavv:a.paymentOption.card.threeD.cavv||"",eci:a.paymentOption.card.threeD.eci||"",xid:a.paymentOption.card.threeD.xid||"",dsTransID:a.paymentOption.card.threeD.dsTransID||"",ccCardNumber:a.paymentOption.card.ccCardNumber||"",bin:a.paymentOption.card.bin||"",last4Digits:a.paymentOption.card.last4Digits||"",ccExpMonth:a.paymentOption.card.ccExpMonth||"",ccExpYear:a.paymentOption.card.ccExpYear||"",threeDVersion:a.paymentOption.card.threeD.version||"",transactionId:a.transactionId,cancelled:!1};c(f(g))}}else c(f(d.responseText))},a.sourceApplication=j.sourceApplication||"WEB_SDK",d.send(JSON.stringify(a))},h={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:navigator.javaEnabled(),language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};if(j.sourceMethod="authenticate3d",a.paymentOption&&a.paymentOption.__makePayment)a.browserDetails=h,a.sourceApplication=j.sourceApplication||"WEB_SDK_FIELDS",a.paymentOption.__makePayment(j,a,function(a){a.threeDVersion=o,c(f(a))});else{a.sourceApplication=j.sourceApplication||"WEB_SDK";var i=JSON.parse(JSON.stringify(a));i.paymentOption=i.paymentOption||{},i.paymentOption.useInitPayment=!0,this.initPayment(i,function(d){a.paymentOption=a.paymentOption||{},e.tempData=d;var f=JSON.parse(JSON.stringify(a));f.paymentOption=f.paymentOption||{},f.paymentOption.card=f.paymentOption.card||{},delete f.currency,delete f.amount,d.paymentOption&&d.paymentOption.card&&d.paymentOption.card.threeD&&(f.paymentOption.card.threeD=f.paymentOption.card.threeD||{},f.paymentOption.card.threeD.v2AdditionalParams=f.paymentOption.card.threeD.v2AdditionalParams||{},f.paymentOption.card.threeD.browserDetails=h,f.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",f.paymentOption.card.threeD.platformType="02",f.paymentOption.card.threeD.isDynamic3D=0,"true"===d.paymentOption.card.threeD.v2supported&&(f.relatedTransactionId=d.transactionId,f.paymentOption.card.threeD.notificationURL=b+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+a.sessionToken),"false"===d.paymentOption.card.threeD.v2supported&&(f.paymentOption.card.threeD={}),d.paymentOption.card.threeD.version&&(f.paymentOption.card.threeD.version=d.paymentOption.card.threeD.version),d.paymentOption.card.threeD.methodCompletionInd&&(f.paymentOption.card.threeD.methodCompletionInd=d.paymentOption.card.threeD.methodCompletionInd)),g(f,c)})}},getApms:function(a,c){n.info("---\x3e sfc.getAmps() input object---------------------- \n"+JSON.stringify(a,null,4)),n.trace("---\x3e sfc.getAmps() stack trace---------------------- \n");var d=new XMLHttpRequest,e=b+"/ppp/api/v1/getMerchantPaymentMethods.do";d.open("POST",e,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.timeout=3e4,d.onload=function(){c(200===d.status?v.parseResult(d.responseText):d.responseText)};var f={sessionToken:j.sessionToken||a.sessionToken,merchantSiteId:j.merchantSiteId||a.merchantSiteId,merchantId:j.merchantId||a.merchantId,timeStamp:(new Date).getTime(),clientRequestId:Math.ceil(1e16*Math.random())};f.type=a.type||"DEPOSIT",a.currencyCode&&(f.currencyCode=a.currencyCode),a.countryCode&&(f.countryCode=a.countryCode),f.languageCode=a.languageCode||"en",d.send(JSON.stringify(f))},createPayment:function(a,c){function d(a,b){window.setTimeout(function(){void 0==a||void 0==a.closed||1==a.closed?b():d(a,b)},200)}if(!0===m.isProcessing)return void c({processingOrder:!0});if(m.isProcessing=!0,a.paymentOption.card,n.trace("---\x3e TRACE createPayment \n"),!a.merchantSiteId&&j.merchantSiteId&&(a.merchantSiteId=j.merchantSiteId),!a.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!a.merchantId&&j.merchantId&&(a.merchantId=j.merchantId),!a.merchantId)throw new Error("Merchant id is mandatory.");var e=this,f={apmgw_WeBanq:!0,apmgw_Moneta__Direct_Integration_:!0,apmgw_Todito_Cash_Direct_Integration_:!0,apmgw_Webmoney_SMS_Invoice_:!0,entropay:!0,visa_checkout:!0,apmgw_WeChat_QuickPay:!0,apmgw_AstropayPrePaid:!0,apmgw_AliPay_Barcode:!0,apmgw_BLIK:!0,apmgw_MuchBetter:!0,apmgw_eCheck:!0,apmgw_MBWAY:!0,apmgw_Playtech_Prepaidcard:!0},g="pppApmWindow_"+(new Date).getTime(),h=null,i=function(d){return m={},d.errCode&&1058===d.errCode?r(b,a.sessionToken,c):(d.transactionType&&"auth"!==d.transactionType.toLowerCase()&&"sale"!==d.transactionType.toLowerCase()&&(d.transactionStatus="ERROR",d.errCode="-5",d.gwExtendedErrorCode="-5",d.errorDescription="General 3D error",d.result="ERROR"),d)},k=function(a,c){var d=new XMLHttpRequest,f=b+"/ppp/api/v1/clientPayment.do";d.open("POST",f,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.timeout=3e4,d.onload=function(){if(200===d.status){var a=v.parseResult(d.responseText);if(void 0===a.all&&(a.all={}),a.all.sourceMethod="createPayment",a.all.server=b,"ERROR"===a.status)a.error={type:"card",code:a.errCode},a.error.message=a.reason||"Process failed.",c(i(a));else if("SUCCESS"===a.status)if(a.paymentOption&&a.paymentOption.card&&a.paymentOption.card.threeD&&a.paymentOption.card.threeD.acsUrl&&(a.paymentOption.card.threeD.paRequest||a.paymentOption.card.threeD.cReq))a.paymentOption.card.threeD.paRequest&&(a.paymentOption.card.threeD.termUrl=b+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+a.sessionToken),e.paymentFrame(a,function(a){c(i(a))});else if(a.paymentOption=a.paymentOption||{},"REDIRECT"===a.transactionStatus)h.location=a.paymentOption.redirectUrl;else{if("ERROR"===a.transactionStatus)try{h.close()}catch(g){}a.paymentOption=a.paymentOption||{},a.paymentOption.card=a.paymentOption.card||{},a=i(a);var f={result:a.transactionStatus,errCode:a.gwExtendedErrorCode||a.gwErrorCode||a.paymentMethodErrorCode||a.errorCode||"0",errorDescription:a.gwErrorReason||a.paymentMethodErrorReason||a.errorDescription||"",userPaymentOptionId:a.paymentOption.userPaymentOptionId,ccCardNumber:a.paymentOption.card.ccCardNumber,bin:a.paymentOption.card.bin,last4Digits:a.paymentOption.card.last4Digits||"",ccExpMonth:a.paymentOption.card.ccExpMonth||"",ccExpYear:a.paymentOption.card.ccExpYear||"",transactionId:a.transactionId,cancelled:!1};c(f)}}else c(i(d.responseText))},a.sourceApplication=j.sourceApplication||"WEB_SDK",d.send(JSON.stringify(a))},l={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:navigator.javaEnabled(),language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};if(j.sourceMethod="createPayment",a.paymentOption&&a.paymentOption.__makePayment)a.browserDetails=l,a.sourceApplication=j.sourceApplication||"WEB_SDK_FIELDS",a.paymentOption.__makePayment(j,a,function(a){c(i(a))});else if(a.paymentOption&&a.paymentOption.userPaymentOptionId&&a.paymentOption.card&&a.paymentOption.card.CVV&&a.paymentOption.card.CVV.__makePayment)a.browserDetails=l,a.sourceApplication=j.sourceApplication||"WEB_SDK_FIELDS",a.paymentOption.card.CVV.__makePayment(j,a,function(a){c(i(a))});else if(a.paymentOption&&a.paymentOption.alternativePaymentMethod&&a.paymentOption.alternativePaymentMethod.paymentMethod&&!f[a.paymentOption.alternativePaymentMethod.paymentMethod]){var o={apmgw_Trustly_DI:{w:600,h:536},default:{w:800,h:600}},p=o.default.w,q=o.default.h,s=screen.width/2-p/2,t=screen.height/2-q/2;h=window.open("http://apmtest.gate2shop.com/ppp/blank.html",g,"height="+q+",width="+p+",top="+t+",left="+s+",toolbar=yes,location=no,directories=no,status=no,menubar=no,linemenubar=no,scrollbars=yes,resizable=yes,modal=yes");var u=function(){var d=new XMLHttpRequest,e=b+"/ppp/api/v1/getPaymentStatus.do";d.open("POST",e,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.timeout=3e4,d.onload=function(){if(200===d.status){var a=i(JSON.parse(d.response));a.paymentOption=a.paymentOption||{},a.paymentOption.card=a.paymentOption.card||{};var b={result:a.transactionStatus,errCode:a.gwExtendedErrorCode||a.gwErrorCode||a.paymentMethodErrorCode||a.errorCode||"0",errorDescription:a.gwErrorReason||a.paymentMethodErrorReason||a.errorDescription||"",
userPaymentOptionId:a.paymentOption.userPaymentOptionId,ccCardNumber:a.paymentOption.card.ccCardNumber||"",bin:a.paymentOption.card.bin||"",last4Digits:a.paymentOption.card.last4Digits||"",ccExpMonth:a.paymentOption.card.ccExpMonth||"",ccExpYear:a.paymentOption.card.ccExpYear||"",transactionId:a.transactionId,cancelled:!1};c(b)}},d.send(JSON.stringify({sessionToken:a.sessionToken}))}.bind(this);d(h,u),k(a,c)}else if(a.paymentOption&&a.paymentOption.alternativePaymentMethod&&a.paymentOption.alternativePaymentMethod.paymentMethod&&f[a.paymentOption.alternativePaymentMethod.paymentMethod])k(a,c);else{var w=JSON.parse(JSON.stringify(a));w.paymentOption=w.paymentOption||{},w.paymentOption.useInitPayment=!0,this.initPayment(w,function(d){a.paymentOption=a.paymentOption||{};var e=JSON.parse(JSON.stringify(a));e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},delete e.currency,delete e.amount,d.paymentOption&&d.paymentOption.card&&d.paymentOption.card.threeD&&(e.paymentOption.card.threeD=e.paymentOption.card.threeD||{},e.paymentOption.card.threeD.v2AdditionalParams=e.paymentOption.card.threeD.v2AdditionalParams||{},e.paymentOption.card.threeD.browserDetails=l,e.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",e.paymentOption.card.threeD.platformType="02","true"===d.paymentOption.card.threeD.v2supported&&(e.relatedTransactionId=d.transactionId,e.paymentOption.card.threeD.notificationURL=b+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+d.sessionToken),"false"===d.paymentOption.card.threeD.v2supported&&(e.paymentOption.card.threeD={}),d.paymentOption.card.threeD.version&&(e.paymentOption.card.threeD.version=d.paymentOption.card.threeD.version),d.paymentOption.card.threeD.methodCompletionInd&&(e.paymentOption.card.threeD.methodCompletionInd=d.paymentOption.card.threeD.methodCompletionInd)),k(e,c)})}},initPayment:function(a,c){if(a.paymentOption.card){var d=JSON.parse(JSON.stringify(a));d.paymentOption.card.cardNumber="**** **** **** ****",d.paymentOption.card.expirationMonth="**",d.paymentOption.card.expirationYear="**",d.paymentOption.card.CVV="***",n.info("---\x3e initPayment input object\n"+JSON.stringify(d,null,4)),n.trace("---\x3e TRACE initPayment \n")}else n.info("---\x3e initPayment input object\n"+JSON.stringify(a,null,4)),n.trace("---\x3e TRACE initPayment \n");if(a.paymentOption&&a.paymentOption.__tokenize)a.paymentOption.__tokenize(j,a,function(a){c(a)});else if(a&&a.paymentOption){var e=new XMLHttpRequest,f=b+"/ppp/api/v1/cardTokenization.do";(a.paymentOption.userPaymentOptionId||a.paymentOption.useInitPayment)&&(f=b+"/ppp/api/v1/websdk/initPaymentWithCardTokenization.do"),e.open("POST",f,!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.timeout=3e4,e.onload=function(){if(200!==e.status)return c(JSON.parse(e.responseText));var b=v.parseResult(e.responseText);if("ERROR"===b.status)return b.error={type:"card",code:b.errCode},b.error.message=b.reason||"Process failed.",c(b);if("SUCCESS"!==b.status)return c(b);if(b.transactionStatus&&(a.transactionStatus=b.transactionStatus),b.transactionType&&(a.transactionType=b.transactionType),b.transactionId&&(a.transactionId=b.transactionId),!(b.paymentOption&&b.paymentOption.card&&b.paymentOption.card.threeD&&b.paymentOption.card.threeD.v2supported&&"true"===b.paymentOption.card.threeD.v2supported))return c(b);var d=b.paymentOption.card.threeD;if(a.paymentOption=b.paymentOption||{},a.paymentOption.card=b.paymentOption.card||{},a.paymentOption.card.threeD=b.paymentOption.card.threeD||{},!d.methodUrl)return a.paymentOption.card.threeD.methodCompletionInd="U",c(a);d.methodUrl&&d.methodPayload&&u(d.methodUrl,d.methodPayload,function(a){return b.paymentOption.card.threeD.methodCompletionInd=a,c(b)})},e.ontimeout=function(){return c({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},a.sourceApplication=j.sourceApplication||"WEB_SDK",e.send(JSON.stringify(a))}},paymentFrame:c,getToken:function(a,b){return n.info("---\x3e sfc.getToken() input object\n"+JSON.stringify(b,null,4)),n.trace("---\x3e TRACE sfc.getToken() \n"),{then:function(c){if(b&&b.sessionToken&&(j.sessionToken=b.sessionToken),b&&b.merchantSiteId&&(j.merchantSiteId=b.merchantSiteId),!j.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!j.sessionToken)throw new Error("Session token is mandatory.");a.__tokenize(j,b,c)}}}}}}(window);