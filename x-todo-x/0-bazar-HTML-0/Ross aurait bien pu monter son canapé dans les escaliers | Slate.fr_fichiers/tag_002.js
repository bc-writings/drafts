/*! Copyright (c) 2021 Mediarithmics; All Rights Reserved */

!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){i(1),i(6),i(2),i(5),i(4),i(3),i(7),i(8),i(9),i(11),i(10),i(12),function(t){"use strict";var e=i(10),n=window.navigator.userAgent;if(!/googlebot|bingbot|yandexbot|baiduspider/i.test(n)){var o=!1,s=null,r=(new Date).getTime(),a=i(8),c=(0,i(5).readCookie)("mics_debug_tag"),h=i(2)("tag",c),u=i(3).mics;if(new e(c).setDFPTargeting(),u._tagVersion)return h.warn("The tag was already loaded, aborting."),void d();u._tagVersion="1.7.2",u._reset=function(t){o&&!t||(o=!0,h.info("mics.reset"),l(function(t){u[t]._reset()}),u._token=null,u._initialized=!1,s&&(s.clearWatchDog(),s=null),u._startTime||(u._startTime=r))},u._setConfig=function(t){h.info("mics._setConfig",t),l(function(e){u[e].setConfig(t)})},u._setInstallationId=function(t){l(function(e){u[e].setInstallationId(t)})},u._declareAdvertisingCookieConsent=function(t){l(function(e){u[e].declareAdvertisingCookieConsent(t)})},u._revokeAdvertisingCookieConsent=function(){l(function(t){u[t].revokeAdvertisingCookieConsent()})},u._setEvaluator=function(t){h.info("mics._setEvaluator",t),l(function(e){u[e].setEvaluator(t)})},u._setDeviceInfo=function(t){h.info("mics._setDeviceInfo",t),l(function(e){u[e].setDeviceInfo(t)})},u._setSegmentDefinition=function(t){h.info("mics._setSegmentDefinition",t),l(function(e){u[e].setSegmentDefinition(t)})},window.mics=window.mics||{},window.mics._setConfig=u._setConfig,window.mics._setInstallationId=u._setInstallationId,window.mics._setEvaluator=u._setEvaluator,window.mics._setDeviceInfo=u._setDeviceInfo,window.mics._setSegmentDefinition=u._setSegmentDefinition,window.mics._tagVersion="1.7.2",u._setOperatorId=function(t,e){l(function(i){u[i].setOperatorId(t,e)})},u._setUAID=function(t,e,i){l(function(n){u[n]._setUAID(t,e,i)})},d(),window.addEventListener&&window.addEventListener("beforeunload",function(){l(function(t){u[t].pageQuit()})},!1)}function l(t){for(var e=0;e<u._names.length;e++)t(u._names[e])}function d(){var t=u._queue||{};l(function(t){u[t]&&u[t].context||(u[t]=new a(t,c),window[t]=u[t],"mics"===t&&(u[t]._setConfig=u._setConfig),u[t]._setInstallationId=u._setInstallationId)}),l(function(e){!function(t,e){for(;e.length;){var i=e.shift();h.debug("executing ",i,"on",t),u[t].callMicsMethod(i.method,i.args)}}(e,t[e])})}}()},function(t,e,i){!function(e){"use strict";var n=i(4),o=i(5).readCookie;t.exports=function(t,e,n,o,s,r){this.finished=!1,this.ran=!1,this.operators=[],this.retrievedIds=[],this.timeout=t,this.watchDog=null,this.options=n,this.console=i(2)("CookieMatcher",e),this.tcfstr=o,this.tcfVendorMicsConsent=s,this.tcfPurposesConsents=r},t.exports.prototype={setOperators:function(t){this.operators=t},setIsTcfEnabled:function(t){this.isTcfEnabled=t},end:function(){return this.gatherIdEnd},panicCallback:function(t){this.panicFn=t},gatherOperatorsIds:function(){this.console.info("gatherOperatorsIds",this.operators);for(var t=0;t<this.operators.length;t++)this.gatherId(this.operators[t]);var e=this;this.timeout>0&&(this.watchDog=window.setTimeout(function(){e._timeout()},this.timeout))},setEtid:function(t){this.etid=t,this.finishIfPossible()},gatherId:function(t){var e=this,i=this.options.gather_operator_id_url+"?opid="+t;this.tcfstr&&this.options.enable_tcf_v2_for_cookie_matching&&(i=i+"&gdpr=1&gdpr_consent="+this.tcfstr),this.options.override_transport&&this.options.override_transport(i),n.loadScript(i,function(i){i&&(e.console.info("error while gather_id",t),e.setOperatorId(t,null))})},setOperatorId:function(t,e){(function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1})(this.retrievedIds,e)||!1!==this.isTcfEnabled&&(!0!==this.isTcfEnabled||!0!==this.tcfVendorMicsConsent||!0!==this.tcfPurposesConsents)||(this.console.log("setId("+t+", "+e+")"),this.retrievedIds.push(e),this.finished=this.retrievedIds.length===this.operators.length,this.finishIfPossible())},finishIfPossible:function(t){var e=this;if(e.console.log("try to finish, panicMode:",e.panicMode,"etid:",e.etid,"finished",e.retrievedIds.length),e.finished||t){e.gatherIdEnd=(new Date).getTime();for(var i=[];e.retrievedIds.length;){var s=e.retrievedIds.shift();s&&i.push(s)}e.console.log("finishing.");var r=e.options.cookie_matching_url+"?";e.etid&&(r=r+"etid="+e.etid+"&"),e.tcfstr&&(r=r+"&gdpr=1&gdpr_consent="+this.tcfstr+"&"),e.options.site_token&&(r=r+"$site_token="+e.options.site_token+"&"),e.options.datamart_token&&(r=r+"$dat_token="+e.options.datamart_token+"&");var a=o(this.options.installation_id_namespace);a&&(r=r+"$ins="+a+"&"),r=r+"utidl="+i.join(","),this.options.override_transport&&this.options.override_transport(r),n.loadScript(r,function(t){t&&e.panicFn&&(e.console.info("failed to load get_id"),e.panicFn("$get_id_failed"))}),e.ran=!0,e.destroy()}},_timeout:function(){!1===this.isTcfEnabled||!0===this.isTcfEnabled&&!0===this.tcfVendorMicsConsent&&!0===this.tcfPurposesConsents?this.finishIfPossible(!0):this.destroy()},destroy:function(){window.clearTimeout(this.watchDog)}}}()},function(t,e,i){!function(e){"use strict";var n=i(3);t.exports=function(t,e){return function(i){var o={};function s(i){return function(){if(e&&window.console&&window.console[i])try{var o=Array.prototype.slice.apply(arguments),s=n.durationFromSnippetStart((new Date).getTime())/1e3;o.unshift(t),o.unshift("mics "+s.toFixed(3)+" s"),window.console[i].apply(window.console,o)}catch(t){}}}for(var r=0;r<i.length;r++)o[i[r]]=s(i[r]);return o}("log debug info warn error".split(" "))}}()},function(t,e,i){!function(){"use strict";var e=window.scimhtiraidem;if(window.mics&&window.mics._snippetVersion&&(window.scimhtiraidem||((e=window.scimhtiraidem={})._queue={},e._names=[]),e._queue.mics=window.mics._queue,e._snippetVersion=e._snippetVersion||window.mics._snippetVersion,e._startTime=window.mics._startTime,e._names.push("mics"),e.mics=window.mics),!e)throw new Error("mics is not defined. Did you used the provided snippet ?");t.exports.mics=e,t.exports.durationFromSnippetStart=function(t){return t?t-e._startTime:null}}()},function(t,e,i){!function(){"use strict";e.loadPixel=function(t,e){var i=document.createElement("img");i.style.display="none",i.style.width=i.style.height="0px",e&&(i.onload=function(){e(null,t)},i.onerror=function(){var i=new Error("error while loading "+t);i.url=t,e(i,null)}),i.setAttribute("src",t)},e.loadScript=function(t,e){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",t),i.setAttribute("async","true"),e&&(i.onload=function(){e(null,t)},i.onerror=function(){var i=new Error("error while loading"+t);i.url=t,e(i,null)}),document.getElementsByTagName("script")[0].parentNode.appendChild(i)},e.get=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(n){if(4===this.readyState)if(200===this.status)e(null,i.responseText);else{var o=new Error("error while GETting: "+t);o.url=t,e(o,null)}},i.open("GET",t,!0),i.withCredentials=!0,i.send(null)},e.sendWithBeaconOrWithLoadPixel=function(t,i){if(!navigator.sendBeacon)return e.loadPixel(t,i);if(navigator.sendBeacon(t))i(null,t);else{var n=new Error("Error while calling "+t+"with sendBeacon()");n.url=t,i(n,null)}}}()},function(t,e,i){!function(e){"use strict";var n=i(2)("CookieHelper",!1);t.exports={readCookie:function(t){for(var e=document.cookie.split(";"),i=0;i<e.length;i++){var o=e[i].replace(/ /g,"").split("=");if(o[0]===t)return n.debug("found cookie",o[0],o[1]),o[1]}return null},deleteCookiesStartingWith:function(t){var e=new Date;e.setTime(0),this.updateCookiesExpirationStartingWith(t,e.toGMTString())},updateCookiesExpirationStartingWith:function(t,e){if(t&&e)for(var i=document.cookie.split(";"),o=0;o<i.length;o++){var s=i[o].replace(/ /g,"").split("=");s[0].startsWith(t)&&(n.debug("update cookie",s[0],s[1]),document.cookie=s[0]+"="+s[1]+";path=/;expires="+e)}}}}()},function(t,e,i){!function(e){"use strict";var n=i(5).readCookie;t.exports=function(t,e){this.properties={},this.options=t,this.ready=!1,this.tcfstr=e},t.exports.prototype={_parseSearch:function(t){for(var e,i,n,o=t.substring(1).split("&"),s={},r=0;r<o.length;r++)i=(e=o[r].split("="))[0],n=e[1],s[i]=decodeURIComponent(n).replace(/\+/g," ");return s},_setReady:function(){this.ready=!0},isReady:function(){return this.ready},readPage:function(){this.properties.$referrer=document.referrer,this.properties.$url=""+document.location;for(var t="utm_source utm_medium utm_term utm_content utm_campaign".split(" "),e=this._parseSearch(window.location.search),i=0;i<t.length;i++){var o=t[i];e[o]&&(this.properties["$"+o]=e[o])}if(this.options.local_cookie_name){var s=n(this.options.local_cookie_name);s&&(this.properties.raw_cookie=s)}var r=n("mics_uaid");r&&(this.properties.$uaid=r);var a=n("mics_vid");a&&(this.properties.$vid=a);var c=n(this.options.installation_id_namespace);c&&(this.properties.$ins=c);var h=parseInt(n("mics_lts"),10);isNaN(h)||(this.properties.$lts=h),window.__tcfapi&&(this.properties.$tcfapi=1),this.tcfstr&&(this.properties.$gdpr=1,this.properties.$gdpr_consent=this.tcfstr)},getVid:function(){return this.properties.$vid},getInstallationid:function(){return this.properties.$ins},getLts:function(){return this.properties.$lts},getCookie:function(){return this.properties.$uaid},updateUAID:function(t,e){var i=new Date;i.setTime(i.getTime()+24*this.options.cookie_max_age_in_days*60*60*1e3),t&&(this.properties.$vid=t,document.cookie="mics_vid="+encodeURIComponent(t)+";expires="+i.toGMTString()+";path=/"),e&&(this.properties.$lts=e,document.cookie="mics_lts="+encodeURIComponent(e)+";expires="+i.toGMTString()+";path=/"),this._setReady()},updateInstallationId:function(t){var e=new Date;e.setTime(e.getTime()+24*this.options.cookie_max_age_in_days*60*60*1e3),t&&(this.properties.$ins=t,document.cookie=this.options.installation_id_namespace+"="+encodeURIComponent(t)+";expires="+e.toGMTString()+";path=/")}}}()},function(t,e,i){!function(e){"use strict";function n(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}var o={$user_account_id:"$cuid"},s=i(3),r=i(4);t.exports=function(t,e,n,o,s,r){this.console=i(2)("EventPusher-"+t,r.debug),this.console.info("new EventPusher()"),this.callQueue=[],this.currentPage=n,this.transportFunction=r.override_transport,this.cookieMatcher=o,this.userPoint=s,this.tagStart=e,this.globalProperties={},this.eventsRunning=0,this.endPointUrl=r.end_point_url,this.panicMode=!1,this.errorEvents=[]},t.exports.prototype={sendCallQueue:function(t,e){for(var i=this.callQueue,o=e||{};i.length;){var r=s.durationFromSnippetStart((new Date).getTime());r&&(o.$delay={$push:r,$start:s.durationFromSnippetStart(this.tagStart),$gather_id_end:s.durationFromSnippetStart(this.cookieMatcher.end()),$beacon:t===this.beacon});var a=i.shift();a=n(a=n(a=n(a,this.currentPage.properties),this.globalProperties),o),this.console.info("pushing",a);var c=this.endPointUrl+"?"+this.generateHttpQuery(a);this.eventsRunning++,t(c,this.pixelSentCallback(this)),this.console.log("userpoint",this.userPoint),this.userPoint&&this.userPoint.addEvent(a)}this.panicMode||(this.console.info("complete before panicMode, clearing watchDog"),this.clearWatchDog())},clearWatchDog:function(){this.watchDog&&(this.console.log("clearing watchdog"),window.clearTimeout(this.watchDog),this.watchDog=null)},setWatchDog:function(t){this.console.info("setup watchdog timer to ",t),this.clearWatchDog();var e=this;this.watchDog=setTimeout(function(){e.panic("$count_down_1")},t)},setPanicCallback:function(t){this.panicFn=t},triggerCallsIfPossible:function(){if(this.console.info("trigger calls if possible: currentPage:",this.currentPage,"panicMode:",this.panicMode,", global:",this.globalProperties,"callQueue:",this.callQueue),this.currentPage&&this.currentPage.isReady()||this.panicMode){var t={};this.panicMode&&(t.$error=this.panicReason),this.sendCallQueue(this.transportFunction||r.sendWithBeaconOrWithLoadPixel,t)}},setUserpoint:function(t){this.userPoint=t},pixelSentCallback:function(t){return function(e,i){if(e?(t.eventsRunning--,t.console.info("error with",e)):(t.console.info("successfully sent",i),t.eventsRunning--),t.finishedCallbackFunction&&0===t.eventsRunning){t.console.info("calling callback function: eventsRunning:",t.eventsRunning,"errors:",t.errorEvents);try{t.finishedCallbackFunction.apply(0===t.errorEvents.length)}catch(e){t.console.error("error has occurred while calling callback function",e)}}}},pushDefault:function(){this.push("$page_view")},push:function(t,e){if(!this.currentPage)throw new Error("mics is not initialized, call mics.init(YOUR_TOKEN) first !");(e=e||{}).$ev=t,this.callQueue.push(e),this.triggerCallsIfPossible()},addProperties:function(t){this.globalProperties=n(this.globalProperties,t),this.console.info("properties: ",this.globalProperties)},generateHttpQuery:function(t){var e=[];for(var i in t)if(t.hasOwnProperty(i)&&"object"!=typeof t[i]){var n=o[i]||i;e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[i]))}else if("object"==typeof t[i]&&"object"==typeof JSON){var s=o[i]||i;e.push(encodeURIComponent(s)+"=jso-"+encodeURIComponent(JSON.stringify(t[i])))}return e.join("&")},panic:function(t){this.console.info("switching to panic mode ! reason:",t),this.panicMode=!0,this.panicReason=t,this.triggerCallsIfPossible()},onFinish:function(t,e){this.finishedCallbackFunction=t,this.setWatchDog(e)},beacon:function(t){navigator.sendBeacon(t)},pageQuit:function(){if(this.console.log("page is unloading"),navigator.sendBeacon){for(this.console.log("send call queue with navigator.beacon ("+this.errorEvents.length+" events)");this.errorEvents.length;)this.beacon(this.errorEvents.shift());this.eventsRunning>0&&this.push("$quit_while_running"),this.sendCallQueue(this.beacon,{$error:"page_quit"})}}}}()},function(t,e,i){!function(e){"use strict";function n(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}var o=function(){var t,e=["init","call","config","push","pushDefault","addProperties","addProperty","onFinish","onStart","_reset","syncFeeds"],i=[],n={};for(t=0;t<e.length;t++)n[e[t]]=!0;for(t=0;t<i.length;t++)n[i[t]]=!0;return n}(),s=(new Date).getTime(),r=i(1),a=i(6),c=i(4),h=i(7),u=i(9),l=i(3).mics,d=i(12),p=i(11),g={domain_id:1,cookie_matching_url:"https://cookie-matching.mediarithmics.com/v1/getids",gather_operator_id_url:"https://cookie-matching.mediarithmics.com/v1/gather_id",get_id_path:"/v1/get_id",domain_name:"events.mediarithmics.com",protocol:"https://",events_path:"/v1/visits/pixel",config_server_path:"/v1/conf.js",cookie_max_age_in_days:365,cookie_refresh_in_days:10,local_cookie_name:null,gather_id_timeout_ms:2e3,global_timeout_ms:3e3,override_transport:null},f={xandr:32,mediarithmics:184,google:755};t.exports=function(t,e){this.console=i(2)(t,e),this.cookieMatcher=null,this.eventPusher=null,this.currentPage=null,this.userpoint=null,this.cache=new p(e),this.cookieHelper=i(5),this.segment_evaluator=null,this.segment_definition=null,this.user_agent_info={},this.vid=null,this.enable_local_segment_evaluation=!1,this.device_info={},this.installation_id_namespace=null,this.tcfstr=null,this.vendorIds=f,this.tcfVendorXandrConsent=null,this.tcfVendorGoogleConsent=null,this.tcfVendorMicsConsent=null,this.tcfPurposesConsents=null,this.context=t,this.options=n({debug:e},g),this.globalProperties={$sv:l._snippetVersion},this.console.info("creating tag object",this.globalProperties)},t.exports.prototype={fetchConfig:function(){var t="";this.options.site_token?(this.options=n(this.options,{installation_id_namespace:"mics_"+this.options.site_token}),t="?$site_token="+this.options.site_token+"&cb="+Date.now()):this.options.datamart_token&&(t="?$dat_token="+this.options.datamart_token+"&cb="+Date.now());var e=this.options.protocol+this.options.domain_name+this.options.config_server_path+t;this.options.js_mock_params&&(e=e+"&"+this.options.js_mock_params),c.loadScript(e)},fetchScriptFromUri:function(t){c.loadScript(this.options.protocol+this.options.domain_name+t)},fetchScriptFromUrl:function(t){c.loadScript(t)},addPixel:function(t){var e=this.options.protocol+this.options.domain_name+t;this.options.override_transport?this.options.override_transport(e):c.loadPixel(e)},call:function(t){var e=Array.prototype.slice.apply(arguments).splice(1);this.callMicsMethod(t,e)},callMicsMethod:function(t,e){o[t]?this[t].apply(this,e):this.console.error("The method '"+t+"' is not supported.")},onStart:function(t){t&&t.apply()},setOperatorId:function(t,e){this.cookieMatcher&&this.cookieMatcher.setOperatorId(t,e)},fetchUAID:function(t,e,i){var n,o=new Date;o.setTime(o.getTime()-24*this.options.cookie_refresh_in_days*60*60*1e3);var s=[];!0===this.enable_goo_matching&&(!1===this.enable_tcf_v2_for_cookie_matching||!0===this.enable_tcf_v2_for_cookie_matching&&!0===this.tcfVendorGoogleConsent&&!0===this.tcfVendorMicsConsent)&&s.push("goo"),!0===this.enable_apx_matching&&(!1===this.enable_tcf_v2_for_cookie_matching||!0===this.enable_tcf_v2_for_cookie_matching&&!0===this.tcfVendorXandrConsent&&!0===this.tcfVendorMicsConsent)&&s.push("apx"),this.cookieMatcher.setOperators(s),this.enable_local_segment_evaluation&&this.userPoint&&this.userpoint.getAgent&&(n=this.userpoint.getAgent());var r=this;e&&i>o.getTime()?setTimeout(function(){r._setUAID(t,e,i)},0):n?setTimeout(function(){r._setUAID(t,e,i)},0):this.cookieMatcher.gatherOperatorsIds()},clearWatchDog:function(){this.eventPusher.clearWatchDog()},setConfig:function(t){var e=this;this.currentPage&&(this.console.info("setConfig",t),this.addProperties({$audience_feeds_refresh_period:t.audience_feeds_refresh_period}),this.enable_local_segment_evaluation=!(!t||!t.hasOwnProperty("enable_local_segment_evaluation"))&&t.enable_local_segment_evaluation,this.namespace=t&&t.namespace?t.namespace:"",this.segment_evaluator_uri=t&&t.segment_evaluator_uri?t.segment_evaluator_uri:"",this.segment_evaluator_url=t&&t.segment_evaluator_url?t.segment_evaluator_url:"",this.segment_definition_url=t&&t.segment_definition_url?t.segment_definition_url:"",this.segment_definition_uri=t&&t.segment_definition_uri?t.segment_definition_uri:"",this.user_agent_info=t&&t.user_agent_info?t.user_agent_info:{},this.enable_goo_matching=!t||!t.hasOwnProperty("enable_goo_matching")||t.enable_goo_matching,this.enable_apx_matching=!t||!t.hasOwnProperty("enable_apx_matching")||t.enable_apx_matching,this.enable_tcf_v2_for_cookie_matching=!(!t||!t.hasOwnProperty("enable_tcf_v2_for_cookie_matching"))&&t.enable_tcf_v2_for_cookie_matching,this.cookieMatcher&&this.cookieMatcher.setIsTcfEnabled(this.enable_tcf_v2_for_cookie_matching),this.fetchUAID(this.currentPage.getCookie(),this.currentPage.getVid(),this.currentPage.getLts()),this.enable_local_segment_evaluation&&(this.userpoint=new d(this.namespace,function(t,i){e.addPixel("/v1/edge/pixel?%24site_token="+e.options.site_token+"&%24seg_id="+t+"&%24o=a&%24vid="+encodeURIComponent(i))},function(t,i){e.addPixel("/v1/edge/pixel?%24site_token="+e.options.site_token+"&%24seg_id="+t+"&%24o=d&%24vid="+encodeURIComponent(i))},function(){e.computeSegments()},this.options.debug),this.userpoint.init(),this.eventPusher.setUserpoint(this.userpoint),this.console.info("vector id",this.vid),this.fetchScriptFromUri("/v1/device_info.js"),this.vid&&this.userpoint.setAgent(this.vid,this.user_agent_info),this.segment_evaluator_uri?this.fetchScriptFromUri(this.segment_evaluator_uri):this.segment_evaluator_url&&this.fetchScriptFromUrl(this.segment_evaluator_url),this.segment_definition_uri?this.fetchScriptFromUri(this.segment_definition_uri):this.segment_definition_url&&this.fetchScriptFromUrl(this.segment_definition_url)),this.eventPusher.triggerCallsIfPossible())},setEvaluator:function(t){this.console.info("Setting Segment Evaluator"),"function"==typeof t&&(this.segment_evaluator=t),this.computeSegments()},setSegmentDefinition:function(t){this.console.info("Setting Segment Definition"),this.segment_definition=t.map,this.computeSegments()},setDeviceInfo:function(t){this.console.info("Setting Device Info"),this.device_info=t,this.userpoint&&this.userpoint.setAgent&&(this.userpoint.setAgent(this.vid,this.device_info),this.computeSegments())},getConsentDate:function(t){var e=new Date,i=new Date(t),n=i.getTime();return n>0&&n<e.getTime()?i:e},declareAdvertisingCookieConsent:function(t){var e=this.getConsentDate(t);this.cache.store("mics_user_consent",!0),this.cache.store("mics_consent_ts",e.getTime());var i=new Date;i.setTime(e.getTime()+31536e6),this.cookieHelper.updateCookiesExpirationStartingWith("mics_",i.toGMTString())},revokeAdvertisingCookieConsent:function(){this.cache.store("mics_user_consent",!1),this.cache.remove("mics_consent_ts"),this.cookieHelper.deleteCookiesStartingWith("mics_")},computeSegments:function(){var t=[],e=this;if(this.segment_definition&&this.segment_evaluator){var i=e.userpoint.getUserpoint(),n=Object.keys(e.segment_definition),o=0,s=10;!function r(){var a=o+s;n.slice(o,o+s).forEach(function(n){e.segment_evaluator(i,e.segment_definition[n])&&t.push(n)}),a<n.length?(o=a,setTimeout(r,100)):(e.console.info("Finished Computing Segments",t),e.userpoint.setSegments(t))}()}},_setUAID:function(t,e,i){this.currentPage&&(e&&!this.set&&(this.set=!0,this.vid=e,this.console.log("_setUAID(",e,i,")",this.userpoint),this.currentPage.updateUAID(e,i),this.enable_local_segment_evaluation&&this.userpoint&&this.user_agent_info&&this.userpoint.setAgent(e,this.user_agent_info)),this.eventPusher.triggerCallsIfPossible())},setInstallationId:function(t){var e=this.currentPage.getInstallationid();e?this.currentPage.updateInstallationId(e):this.currentPage.updateInstallationId(t)},hasPurposesConsents:function(t){return!!(t&&Object.keys(t).length>0&&t.hasOwnProperty("1")&&t.hasOwnProperty("3"))&&(t[1]&&t[3])},getVendorConsent:function(t,e){return!!(t&&Object.keys(t).length>0&&void 0!==t[e])&&t[e]},init:function(t){if(void 0===t)throw new Error(this.context+".init : use a token string or an object");var e=null;if(e=n(this.options,"string"==typeof t?{mode:"VISIT",site_token:t,domain_name:this.options.domain_name}:t),t.cookie_matching_url?this.console.info("overriding cookie_matching_url with ",t.cookie_matching_url):t.domain_name&&(e.cookie_matching_url=e.protocol+e.domain_name+e.get_id_path,this.console.info("using custom domain, cookie_matching_url will be ",e.cookie_matching_url)),this.console.info("mcsObj.config, new configuration is",e),this.options=e,window.__tcfapi){var i=this;window.__tcfapi("getTCData",2,function(t,e){e&&(i.tcfstr=t.tcString,t.purpose&&(i.tcfPurposesConsents=i.hasPurposesConsents(t.purpose.consents)),t.vendor&&(i.tcfVendorGoogleConsent=i.getVendorConsent(t.vendor.consents,i.vendorIds.google),i.tcfVendorXandrConsent=i.getVendorConsent(t.vendor.consents,i.vendorIds.xandr),i.tcfVendorMicsConsent=i.getVendorConsent(t.vendor.consents,i.vendorIds.mediarithmics)))})}var o=null,c=null;if("VISIT"===e.mode)o="/v1/visits/pixel",c=this.globalProperties.$site_token=e.site_token;else{if("TOUCH"!==e.mode)throw new Error(this.context+".init : invalid mode ("+e.mode+")");o="/v1/touches/pixel",c=this.globalProperties.$dat_token=e.datamart_token}if(null===this.eventPusher){if("string"!=typeof c)throw new Error(this.context+".init : the token must be a string");if(0===c.length)throw new Error(this.context+".init : the token must be a non-empty string");this.currentPage=new a(e,this.tcfstr),this.fetchConfig(),this.cookieMatcher=new r(e.gather_id_timeout_ms,e.debug,e,this.tcfstr,this.tcfVendorMicsConsent,this.tcfPurposesConsents),this.currentPage.readPage(this.installation_id_namespace);var u={end_point_url:e.protocol+e.domain_name+o,debug:e.debug,override_transport:e.override_transport};this.eventPusher=new h(this.context,s,this.currentPage,this.cookieMatcher,this.userpoint,u),this.eventPusher.addProperties(this.globalProperties),this.eventPusher.setWatchDog(e.global_timeout_ms),this.cookieMatcher.panicCallback(this.eventPusher.panic),this.addProperty("$tv","1.7.2")}else this.console.warn(this.context+" was already initialized, stop initialization")},pageQuit:function(){this.eventPusher&&this.eventPusher.pageQuit()},onFinish:function(t,e){this.eventPusher.onFinish(t,e)},pushDefault:function(){this.push("$page_view")},push:function(t,e){if(!this.eventPusher)throw new Error(this.context+" is not initialized, call "+this.context+".init(YOUR_TOKEN) first !");this.eventPusher.push(t,e)},addProperty:function(t,e){this.console.debug("addProperty",t,e);var i={};i[t]=e,this.addProperties(i)},addProperties:function(t){this.console.debug("addProperties",t),this.eventPusher?this.eventPusher.addProperties(t):this.globalProperties=n(this.globalProperties,t)},_reset:function(){this.console.info("reset ",this.context),this.set=!1,this.options=n({debug:this.options.debug},g),this.globalProperties={$sv:l._snippetVersion},this.cookieMatcher=null,this.eventPusher=null,this.currentPage=null,this.tcfVendorXandrConsent=null,this.tcfVendorGoogleConsent=null,this.tcfVendorMicsConsent=null,this.tcfPurposesConsents=null,window.__tcfApi=null},config:function(t){return t=t||{},this.options=n(this.options,t),t.cookie_matching_url?this.console.info("overriding cookie_matching_url with ",t.cookie_matching_url):t.domain_name&&(this.options.cookie_matching_url=this.options.protocol+this.options.domain_name+this.options.get_id_path,this.console.info("using custom domain, cookie_matching_url will be ",this.options.cookie_matching_url)),this.console.info("mcsObj.config, new configuration is",this.options),this.options},syncFeeds:function(t){u.processExternalFeeds({period:this.globalProperties.$audience_feeds_refresh_period,site_token:this.options.site_token,domain_name:this.options.domain_name,callback:t})},_externalFeeds:u,_loaders:c}}()},function(t,e,i){!function(e){"use strict";t.exports={processExternalFeeds:function(t){o({s:window.localStorage?localStorage:{setItem:function(t,e){},getItem:function(t){return null}},hc:i(4),c:Date,p:t.period,st:t.site_token,dn:t.domain_name,cb:t.callback})},processExternalFeedsWith:o};var n=864e5;function o(t){t=function(t){return{s:t.s,hc:t.hc,c:t.c,p:t.p?t.p:n,st:t.st,dn:t.dn,cb:function(t){if(t&&"function"==typeof t)return t;return function(t,e){}}(t.cb)}}(t);var e=JSON.parse(t.s.getItem("_mediarithmics")),i=(e=e||{})[t.st];(!i||t.c.now()-i.lastFeedRefreshDate>t.p)&&t.hc.get("https://"+t.dn+"/v1/sites/"+t.st+"/external_feeds",function(i,n){if(i)t.cb(i,null);else{var o=JSON.parse(n);e[t.st]={lastFeedRefreshDate:t.c.now()},t.s.setItem("_mediarithmics",JSON.stringify(e)),o.scripts.map(function(e){var i;"INLINE"===e.type?((i=document.createElement("script"))[void 0===i.innerText?"textContent":"innerText"]=e.inner,document.head.appendChild(i)):"SRC"===e.type?((i=document.createElement("script")).src=e.source,document.head.appendChild(i)):"IMG"===e.type&&t.hc.loadPixel(e.source,void 0)}),t.cb(null,o.feeds)}})}}()},function(t,e,i){!function(e){"use strict";var n=i(11);t.exports=function(t){this.console=i(2)("Adserver",t),this.cache=new n(t),this.debug=t,this.console.info("Starting Ad Server Connection")},t.exports.prototype={setDFPTargeting:function(){var t=this;try{window.googletag&&window.googletag.cmd?window.googletag.cmd.push(function(){var e=t.cache.get("mics_sgmts"),i=JSON.parse(e),n=i||{};Object.keys(n).forEach(function(t){window.googletag.pubads().setTargeting("mics_"+t,n[t].map(String))})}):this.console.info("DFP is not present")}catch(t){this.console.error("error setting DFP",t)}}}}()},function(t,e,i){!function(e){"use strict";t.exports=function(t){this.console=i(2)("Cache",t),this.localStorage=window.localStorage,this.canUseLocalStorage=this.isLocalStorageEnabled(),this.debug=t},t.exports.prototype={get:function(t){if(this.canUseLocalStorage)return this.localStorage.getItem(t)},store:function(t,e){this.canUseLocalStorage&&this.localStorage.setItem(t,e)},remove:function(t){this.canUseLocalStorage&&this.localStorage.removeItem(t)},isLocalStorageEnabled:function(){try{var t="is_enabled";this.localStorage.setItem(t,!0);var e=this.localStorage.getItem(t);return e||!1}catch(t){return this.debug&&this.console.log("localStorage is not enabled",t),!1}}}}()},function(t,e,i){!function(e){"use strict";var n=i(11);t.exports=function(t,e,o,s,r){this.console=i(2)("UserPoint",r),this.cache=new n(r),this.debug=r,this.namespace=t,this.onEvent=s,this.onAddition=e,this.onDeletion=o},t.exports.prototype={init:function(){this.console.info("Starting UserPoint System"),this.userpoint=this.getUserpoint(),this.saveUserpoint()},reset:function(){this.console.info("Resetting userpoint system"),this.cache.remove(this.namespace+"_mics_up")},getUserpoint:function(){var t={profiles:[],segments:[],activities:[],events:[],emails:[],agents:[]},e=this.cache.get(this.namespace+"_mics_up");if(!e)return t;try{return this.decrypt(e)}catch(e){return this.console.error("Failed to parse userpoint"),t}},saveUserpoint:function(){var t=this.encrypt(this.userpoint);this.cache.store(this.namespace+"_mics_up",t);var e=this.cache.get("mics_sgmts"),i=this.getSegmentIds()?this.getSegmentIds():[];e&&"object"==typeof e?e[this.namespace]=i:(e={})[this.namespace]=i,this.cache.store("mics_sgmts",JSON.stringify(e)),this.console.info("Saving UserPoint",this.userpoint)},setSegments:function(t){var e=this.getSegmentIds(),i=t.filter(function(t){return!e.find(function(e){return t===e})}),n=e.filter(function(e){return!t.find(function(t){return e===t})});if(0!==i.length||0!==n.length){this.userpoint.segments=t.map(function(t){return{id:t,creation_ts:Date.now(),last_modified_ts:Date.now(),expiration_ts:null}}),this.console.info("New Segments",i,"Removed Segments",n,"segments",t),this.saveUserpoint();var o=this;o.onAddition&&i.forEach(function(t){o.onAddition(t,o.getVectorId())}),o.onDeletion&&n.forEach(function(t){o.onDeletion(t,o.getVectorId())})}},setAgent:function(t,e){e&&e!=={}||this.userpoint.agents.length&&this.this.userpoint.agents[0].user_agent_info&&(void 0!==this.this.userpoint.agents[0].user_agent_info||this.this.userpoint.agents[0].user_agent_info!=={})&&(e=this.this.userpoint.agents[0].user_agent_info),t&&""!==t||this.userpoint.agents.length&&this.this.userpoint.agents[0].id&&(t=this.this.userpoint.agents[0].id);var i={id:"vec:"+t,creation_date:Date.now(),creation_ts:Date.now(),user_agent_info:e};this.userpoint.agents=[i],this.saveUserpoint()},getAgent:function(){return this.userpoint.agents&&this.userpoint.agents.length?this.userpoint.agents[0].id.split(":")[1]:null},getVectorId:function(){return this.userpoint.agents&&this.userpoint.agents.length?this.userpoint.agents[0].id:null},getSegmentIds:function(){return this.userpoint.segments.map(function(t){return t.id}).map(String)},addEvent:function(t){var e=this.formatEvent(t);this.userpoint.events.unshift(e),this.userpoint.events=this.userpoint.events.slice(0,200),this.computeActivities(),this.saveUserpoint(),this.onEvent()},formatEvent:function(t){return t.name=t.$ev,t.referrer=t.$referrer,t.date=Date.now(),t.url=t.$url,t.site_token=t.$site_token,delete t.$web_domain_token,delete t.$web_domain_id,delete t.$etag_id,delete t.$vector_last_seen,delete t.$tag_version,delete t.$delay,delete t.$error,delete t.$snippet_version,delete t.$check_cookie_drop_param,delete t.$consent_from_tcf_api,delete t.$gdpr_consent,delete t.$gdpr_applies,delete t.$installation_id,Object.assign(t,t.properties)},computeActivities:function(){},encrypt:function(t){return JSON.stringify(t)},decrypt:function(t){return JSON.parse(t)}}}()}]);