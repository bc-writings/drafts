(function(){'use strict';$.fn.loadBookmark=function(){var userId=$(".bookmark-properties").data("user-id");var contentId=$(".bookmark-properties").data("content-id");var marked=$(".bookmark-properties").data("marked");var bookmarkCount=parseInt($(".bookmark-properties").data("bookmark-count"));var loginUrl=$(".bookmark-properties").data("login-url");var data=JSON.stringify({"userId":userId,"contentId":contentId});if(marked=="True"){$('.btnSetBookmark').hide();$('.btnRemoveBookmark').show();$('.btn-mybookmarks').hide();if(bookmarkCount>0){$('.btn-mybookmarks').show();}}else{$('.btnSetBookmark').show();$('.btn-mybookmarks').hide();$('.btnRemoveBookmark').hide();}
var bkid=getParameterByName('bkid');if(bkid!=""){if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/AddBookmark",data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){if(textStatus=="success"){$('.btnSetBookmark').hide();$('.btnRemoveBookmark').show();$('.btn-mybookmarks').show();}},error:function(data,status,error){console.info("error: "+error);}});}else{window.location=loginUrl;}}
$('.btnSetBookmark').click(function(){if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/AddBookmark",data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){if(textStatus=="success"){$('.btnSetBookmark').hide();$('.btnRemoveBookmark').show();$('.btn-mybookmarks').show();}},error:function(data,status,error){console.info("error: "+error);}});}else{window.location=loginUrl;}});$('.btnRemoveBookmark').click(function(){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/RemoveBookmark",data:data,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){if(textStatus=="success"){$('.btnSetBookmark').show();$('.btnRemoveBookmark').hide();}},error:function(data,status,error){console.info("error: "+error);}});});function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));}};$.fn.manageBookmarks=function(){var userId=$(".bookmark-properties").data("user-id");var currentItemId;var selectedTag;$('.label-tabs').on('click','.label-filter',function(e){var tab=$(this).data('label');$('.label-tabs li.active').removeClass('active');$(this).parent('li').addClass('active');e.preventDefault();$('.content-listing .item').each(function(){if(tab=="all"){$(this).show();}else if(tab!=$(this).attr('data-selected-tag')){$(this).hide();}else{$(this).show();}});});$('.content-listing').on('click','.btn-remove-label',function(e){var contentId=$(this).closest('.item').attr('id');e.preventDefault();var removeData=JSON.stringify({"userId":userId,"contentId":contentId});$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/RemoveBookmark",data:removeData,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){if(textStatus=="success"){var item=$("#"+contentId);item.fadeOut(function(){item.remove();});}},error:function(data,status,error){console.info("error: "+error);}});});$('.content-listing').on('click','.btn-add-label',function(e){currentItemId=$(this).closest('.item').attr('id');selectedTag=$(this).closest('.item').attr('data-selected-tag');$("#addlabel input:radio[value="+selectedTag+"]").attr('checked','checked');var $radios=$('#addlabel input:radio');if($radios.is(':checked')===false){$radios[0].prop('checked',true);}});$('#addlabel').on('click','button.btn-save-label',function(e){e.preventDefault();var textbox=$('#newlabel2 input.add-new-label');if(textbox.val()!=""){var newLabel=JSON.stringify({"userId":userId,"tag":textbox.val()});console.info(newLabel);if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/AddBookmarkTag",data:newLabel,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){$('#managelabels .list-labels').append('<div class="checkbox"><input type="checkbox" class="cb-label"><label>'+textbox.val()+'</label></div>');$('#addlabel .list-labels').append('<div class="radio"><label><input type="radio" name="labels" value="'+textbox.val()+'" checked="checked" />'+textbox.val()+'</label></div>');$('.label-tabs').append('<li><a href="#" class="label-filter" data-label="'+textbox.val()+'">'+textbox.val()+'</a></li>');textbox.val('');},error:function(data,status,error){console.info("error: "+error);}});}}});$('#addlabel').on('click','button.btn-save-label-changes',function(e){e.preventDefault();var selectedLabel=$('#addlabel .list-labels input:radio:checked').val();var newLabel=JSON.stringify({"userId":userId,"contentId":currentItemId,"tag":selectedLabel});console.info(newLabel);if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/SetBookmarkTag",data:newLabel,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){$('#'+currentItemId).attr('data-selected-tag',selectedLabel).find('.label').html(selectedLabel);$('#addlabel').modal('hide');},error:function(data,status,error){console.info("error: "+error);}});}});$('#managelabels').on('click','button.btn-delete-labels',function(e){e.preventDefault();var values=$('#managelabels .list-labels input:checkbox:checked').map(function(){return this.value;}).get();var selectedLabels=JSON.stringify({"userId":userId,"labelIds":values});console.info(selectedLabels);if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/RemoveBookmarkTags",data:selectedLabels,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){$('#managelabels .list-labels input:checkbox:checked').each(function(){var label=this.value.replace(/ /g,'');;$(this).closest('.checkbox').remove();$('.label-tabs a').each(function(){if($(this).text()==label){$(this).parent().remove();}});$('.content-listing [data-selected-tag="'+this.value+'"]').each(function(){$(this).find('.label').html('');}).removeClass('lbl-'+label);$('#addlabel .list-labels input:radio[value='+label+']').each(function(){$(this).closest('.radio').remove();});});$('#managelabels').modal('hide');},error:function(data,status,error){console.info("error: "+error);}});}});$('#managelabels').on('click','button.btn-save-label',function(e){e.preventDefault();var textbox=$('#newlabel input.add-new-label');if(textbox.val()!=""){var newLabel=JSON.stringify({"userId":userId,"tag":textbox.val()});console.info(newLabel);if(userId!="0"){$.ajax({type:"POST",url:"/NCTMWebAPI.asmx/AddBookmarkTag",data:newLabel,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data,textStatus){$('#managelabels .list-labels').append('<div class="checkbox"><input type="checkbox" class="cb-label"><label>'+textbox.val()+'</label></div>');$('#addlabel .list-labels').append('<div class="radio"><label><input type="radio" name="labels" value="'+textbox.val()+'" />'+textbox.val()+'</label></div>');$('.label-tabs').append('<li><a href="#" class="label-filter" data-label="'+textbox.val()+'">'+textbox.val()+'</a></li>');textbox.val('');$('#managelabels').modal('hide');},error:function(data,status,error){console.info("error: "+error);}});}}});};})();