(window.webpackJsonp_spotim_580132258=window.webpackJsonp_spotim_580132258||[]).push([[27],{458:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var o,i=n(16),r=n(20),a=n.n(r),s=n(37);n(604);function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[a.a],r=[i.applyMiddleware.apply(void 0,n)],c=i.compose;return o=Object(i.createStore)(Object(s.a)(),t,c.apply(void 0,r)),e.window&&(window.__SPOTIM_DEV_STORE__=o),o}}).call(this,n(75))},604:function(e,t,n){"use strict";!function(){try{!("undefined"==typeof window||!window.localStorage)&&(window.localStorage.setItem("test","test"),window.localStorage.removeItem("test"))}catch(e){return!1}}()},608:function(module,__webpack_exports__,__webpack_require__){"use strict";function parseSpotOptions(code){var hostOptions={};if(code)try{!function(c){try{var SPOTIM_OPTIONS={};eval(c),hostOptions=Object.assign(hostOptions,SPOTIM_OPTIONS)}catch(e){console.error("Failed to parse host options")}}(code)}catch(e){console.error("Failed to parse host options")}return hostOptions}__webpack_require__.d(__webpack_exports__,"a",(function(){return parseSpotOptions}))},895:function(e,t,n){"use strict";n.r(t);var o=n(22),i=n.n(o),r=n(23),a=n.n(r),s=n(4),c=n(14),l=n.n(c),d=n(259),u=n(261),p=n(262),m=n(30),_=n.n(m),f=n(50),b=n.n(f),v=n(2),O=n.n(v),g=n(458),y=n(26);n(100),n(149);var h=n(39),w=n(444),I=function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&void 0};function k(e){switch(e.toUpperCase()){case"DARK":return"dark";case"LIGHT":return"light";default:return}}var S=n(445);function T(e){switch(e.toUpperCase()){case"FACEBOOK":return"facebook";case"TWITTER":return"twitter";case"EMAIL":return"email";case"DISQUS":return"disqus";case"GOOGLE":return"google";case"MICROSOFT":return"microsoft";case"LINKEDIN":return"linkedin";case"VK":return"vk";default:return}}var C=["he","ar","fa"],j=n(608),P=n(265);function R(e){var t,n;if(e.brandColor=(t=e.brandColor,/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(t)?e.brandColor:void 0),e.newsfeedPosition=function(e){switch(e.toUpperCase()){case"LEFT":return"LEFT";case"RIGHT":return"RIGHT";default:return}}(e.newsfeedPosition),e.tickerSkin=function(e){switch(e.toUpperCase()){case"BRAND":case"WHITE":return"BRAND";default:return}}(e.tickerSkin),e.openMode=function(e){switch(e.toUpperCase()){case"AUTOMATIC":return"AUTOMATIC";case"PERMANENT":return"PERMANENT";case"ON_CLICK":return"ON_CLICK";default:return}}(e.openMode),e.conversationSort=function(e){switch(e.toUpperCase()){case"BEST":return"best";case"NEWEST":return"newest";case"OLDEST":return"oldest";default:return}}(e.conversationSort),e.conversationSkin=k(e.conversationSkin),e.registrationSkin=k(e.registrationSkin),e.connectTypes=(n=e.connectTypes,Array.isArray(n)?n.map(T).filter((function(e){return void 0!==e})):[]),e.isConnectEnabled=!(!(e.connectTypes.length>0)||1===e.connectTypes.length&&"disqus"===e.connectTypes[0]),e.useDisqusLogin=e.connectTypes.length>0&&e.connectTypes.indexOf("disqus")>-1,e.direction=C.indexOf(e.mainLanguage)>-1?"rtl":"ltr",e.hostOptionsBlock){var o=Object(j.a)(e.hostOptionsBlock);Object(P.a)(e,o)}return Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),Object(S.b)(e)}function E(e){return R(e=function(e){return{spotId:e.id,spotName:e.name,networkId:e.network?e.network.id:void 0,tickerIcon:e.ticker_icon,tickerIconSize:e.ticker_icon_size,brandColor:e.brand_color,buttonEnabled:e.button_enabled,categoryId:e.category_id,subCategoryId:e.sub_category_id,languages:e.languages,mainLanguage:e.main_language,newsfeedSkin:e.newsfeed_skin,newsfeedPosition:e.newsfeed_position,tickerSkin:e.ticker_skin,openMode:e.opening_mode,conversationSort:e.sort_by,conversationSkin:e.inpage_skin,registrationSkin:e.inpage_skin,platform:e.platform,websiteUrl:e.website_url,enableSSO:e.sso_enabled,editableSSO:e.sso_editable_profile,hasCommunity:e.has_community,enableConversationHeaderFacesList:I(e.enable_avatars_bar),numberedAvatars:!(!e.avatars||!e.avatars.numbered)&&e.avatars.numbered,displayNameInSayControlForGuests:!!e.display_name_in_say_control_for_guests&&e.display_name_in_say_control_for_guests,connectTypes:e.connect_networks,conversationRecommendationsRowsCount:e.circulation&&e.circulation.rows_count?e.circulation.rows_count:1,popularItemsCount:e.newsfeed_items_count||0,enableMiniNewsfeed:"mini_newsfeed_enabled"in e?e.mini_newsfeed_enabled:void 0,enableNewsfeed:"newsfeed_enabled"in e?e.newsfeed_enabled:void 0,enableRecommendation:e.circulation&&"enabled"in e.circulation?e.circulation.enabled:void 0,forceRegister:e.policy&&"force_register"in e.policy?e.policy.force_register:void 0,enableBlindfold:e.policy&&"roger_mode"in e.policy?e.policy.roger_mode:void 0,enableGuestVoting:e.policy&&"allow_guests_to_like"in e.policy?e.policy.allow_guests_to_like:void 0,enableRealtimeCommentsSticky:I(e.enable_realtime_comments_sticky),enableDownVotesCount:e.enable_dislikes,enableUserPoints:e.enable_user_points,whitelistUrls:e.whitelisted_urls,hostOptionsBlock:e.injection&&"host_options"in e.injection&&e.injection.host_options?e.injection.host_options:void 0,scriptBlock:e.injection&&"frame_script"in e.injection&&e.injection.frame_script?e.injection.frame_script:void 0,styleBlock:e.injection&&"frame_style"in e.injection&&e.injection.frame_style?e.injection.frame_style:void 0,enableSpotimUtm:e.enable_spotim_utm,openLinksInNewTab:e.open_links_in_new_tab,useExternalUserId:e.external_public_profile,conversationRichToolbarEnabled:I(e.rich_say_control_enabled),repliesMaxDepth:e.comment_replies_max_depth,animationRating:("PG_13"===e.giphy_level?"PG-13":e.giphy_level||"none").toLowerCase()}}(e))}var U=n(187),L=n(186),M=n(33),B=n(160);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){_()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A={spotId:void 0,hostOptions:void 0,urlOptions:void 0,predefinedOptions:void 0,deprecatedOptions:void 0,initialModuleOptions:void 0,elementsOptions:[]};function D(e,t){var n="".concat(M.x,"_").concat(e),o=O.a.get("elementOptions",{}),i=(o.postId,b()(o,["postId"])),r=O.a.get("queryParams"),a=t.isConsumedUrlParams?{}:F(x({},r));t.backToCommentsOverride.useOverride&&(a=x(x({},a),F({spot_im_comment_id:t.backToCommentsOverride.commentId,spot_im_reply_id:t.backToCommentsOverride.replyId,spot_im_force_sayctrl_focus:t.backToCommentsOverride.forceFocusMainSayCtrl,spot_im_expand_reply:t.backToCommentsOverride.disableMessageSayCtrlFocusOnMount&&(t.backToCommentsOverride.commentId||t.backToCommentsOverride.replyId),spot_im_scroll_to_comments:!0,spot_im_highlight_immediate:!0})));var s,c=Object(g.a)();return c.dispatch((s={moduleOptions:x(x(x({},Object(w.a)({moduleOptions:x(x(x(x({},A),{},{initialModuleOptions:E(O.a.get("init_data.config")),conversationId:n,spotId:M.x,postId:e},a),{},{eventCode:O.a.get("elementOptions.liveEventCode"),isRecommendedPost:O.a.get("elementOptions.recommendablePost",!0),conversationArticleTags:O.a.get("elementOptions.articleTags")},t),{},{isSafeFrame:M.s})})),i),{},{isStarsRatingEnabled:O.a.get("elementOptions.socialReviews"),communityQuestion:O.a.get("elementOptions.communityQuestion")||""})},function(e){e({type:y.H,payload:s})})),c.dispatch(Object(B.b)({isReadOnly:t.isReadOnly})),c.dispatch(Object(L.b)(Object(h.b)()?U.a.MOBILE:U.a.DESKTOP)),c}function F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={spot_im_comment_id:"highlightedCommentId",spot_im_reply_id:"highlightedReplyId",spot_im_highlight_immediate:"highlightImmediate",spot_im_scroll_to_comments:"scrollToComments",spot_im_expand_reply:"isSayControlExpanded",spot_im_max_messages_depth:"repliesMaxDepth","read-only-implementation":"readOnlyImplementation",spot_im_force_sayctrl_focus:"focusMainSayCtrlOnMount"};return Object.keys(t).reduce((function(n,o){var i=e[o];if(i){var r=t[o];switch(i){case"true":i=!0;break;case"false":i=!1}n[r]=i}return n}),{})}var G=n(13);var q=n(69),z=Object(G.createAction)(y.nb,(function(e){var t,n,o=Object(q.a)(e);if(!e.currentUser.isRegistered){var i=Object(c.getDisplayName)(e.currentUser);o.currentUser.displayName=i}return o.currentUser.isRegistered&&!o.currentUser.email&&(o.currentUser.email=((n=localStorage.getItem("spotim_signup.email")||localStorage.getItem("spotim_signin.email"))&&(t=(n=JSON.parse(n)).data.value),t)),o})),K=n(44),H=n(3),J=n(126);var V=n(255);function W(){var e=Object(H.getLocation)().href;if(Object(V.b)(e).spot_im_scroll_to_comments){var t,n,o=[].slice.call(document.querySelectorAll(J.c));o&&o.length&&window.scrollTo({top:null===(t=o[0])||void 0===t||null===(n=t.getBoundingClientRect())||void 0===n?void 0:n.top,behavior:"smooth"})}}var Q=n(351),$=n(353),X=n(348),Y=n(354);function Z(e){if(O.a.get("tenant_config.conversation.ssoSyncCheck",!1)){var t=e.currentUser;try{var n=JSON.parse(localStorage.getItem("SPOTIM_CURRENT_USER")||"")}catch(e){return void s.a.error("checkSSO",e)}var o=n&&n.data&&n.data.id;t.id!==o&&window.SPOTIM.startSSO(ee)}}function ee(e,t){fetch("https://www.thesun.co.uk/api/comments/signin?codeA=".concat(e),{credentials:"include",headers:{accept:"application/json","cache-control":"no-cache",pragma:"no-cache","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors"}).then((function(e){return e.json()})).then((function(e){return t(e.spotimCodeB)}))}var te=n(273),ne=n(219),oe=n(105);function ie(e,t){return re.apply(this,arguments)}function re(){return(re=a()(i.a.mark((function e(t,n){var o,r,a,s,c,l,d,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.getState(),r=o.moduleOptions,r.spotId){e.next=4;break}return e.abrupt("return");case 4:a=O.a.get("queryParams"),s=a.spot_reset_password,c=a.spot_ticket,l=a.spot_im_verify,d=a.email,p="success"===s&&c,((u="email"===l||"signup"===l)||p)&&(u?Object(oe.c)({mode:"email-verified"}):p&&Object(oe.c)({mode:"set-password",resetPasswordTicket:c,email:d}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(106),se=n(51),ce=n(358),le=n(218);n.d(t,"boot",(function(){return me}));var de=function(){var e=a()(i.a.mark((function e(t){var o,r,a,s,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.element,r=t.spotId,a=t.postId,s=t.isLiveBlog,c=t.force,l=t.instanceId,Promise.all([n.e(0),n.e(5),n.e(12),n.e(1),n.e(8),n.e(9),n.e(56)]).then(n.bind(null,900)).then((function(e){e.renderRetryConv(o,(function(e){me({element:e,spotId:r,postId:a,isLiveBlog:s,force:c,instanceId:l})}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(e){var t=e.element,n=e.spotId,o=e.postId,i=e.isLiveBlog,r=e.instanceId,a=e.store,c=e.force;Object(Q.a)().then((function(){a.dispatch(Object(X.c)({isTranslationInitialize:!0}))})).catch((function(e){s.a.error("loadTranslations",e),de({element:t,spotId:n,postId:o,isLiveBlog:i,force:c,instanceId:r})}))},pe=function(e){var t=e.element,n=e.postId,o=e.isLiveBlog,i=e.contentType,r=e.store,a=e.user,l=r.getState(),u=l.appState.isUserInitialized,p=l.currentUser,m=l.moduleOptions.isConversationPage,_=l.isReadOnly;r.dispatch(z({currentUser:a})),Object(c.isSameUser)(p,a)||function(e){var t,n=e.element,o=e.postId,i=e.isLiveBlog,r=e.contentType,a=e.dispatch,c=e.isConversationPage,l=e.isReadOnly,u="true"===n.getAttribute(M.f),p=new Promise((function(e){t=setTimeout((function(){e(!1)}),M.c)}));Promise.race([p,Object(d.a)({postId:o,element:n,isPreview:u,isLiveBlog:i})]).then((function(e){var n;if(!e||!e.data)return s.a.error("conversation failed to load",new Error("read failed")),void a(Object(le.a)({conversationStatus:se.c.ERROR}));clearTimeout(t);var i=e.data;a(Object(Y.a)({data:i,postId:o,contentType:r})),a(Object(B.b)({isReadOnly:!(!l&&!(null===(n=i.conversation)||void 0===n?void 0:n.read_only))})),Object(ce.a)(c)&&a(Object(ae.a)(se.a.Conversation,!1))})).catch((function(e){s.a.error("loadConversation",e),a(Object(le.a)({conversationStatus:se.c.ERROR}))}))}({element:t,postId:n,isLiveBlog:o,contentType:i,dispatch:r.dispatch,isConversationPage:m,isReadOnly:_}),u||r.dispatch(Object(X.d)({isUserInitialized:!0})),a.unseenNotificationsCount&&r.dispatch(Object($.a)(a.unseenNotificationsCount))};function me(e){return _e.apply(this,arguments)}function _e(){return(_e=a()(i.a.mark((function e(t){var o,r,a,s,c,d,m,_,f,b,v,O,g,y,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.element,c=t.spotId,d=t.postId,m=t.isLiveBlog,_=t.force,f=t.instanceId,s){e.next=3;break}return e.abrupt("return");case 3:if(!("false"===s.getAttribute(M.a))||_){e.next=6;break}return e.abrupt("return");case 6:if(d){e.next=8;break}return e.abrupt("return");case 8:if(null===(o=window)||void 0===o||null===(r=o.__OPEN_WEB__)||void 0===r||null===(a=r.initCurrentUser)||void 0===a||a.call(r,{spotId:c,postId:d}),W(),b=s.getAttribute("data-content-type")||se.b.Conversation,Object(q.h)(!0),v=s.dataset.spotImScrollToComment,O=s.dataset.spotImScrollToReply,g="true"===s.dataset.autoFocus,y=D(d,{isConversationLiveBlog:m,isConversationPage:"true"===s.getAttribute("data-spotim-conversation-page"),contentType:b,instanceId:f,backToCommentsOverride:{commentId:v,replyId:O,useOverride:!!v||!!O||g,disableMessageSayCtrlFocusOnMount:!g,forceFocusMainSayCtrl:g&&!v&&!O},isConsumedUrlParams:!!s.dataset.isConsumedUrlParams,elementId:Object(ne.a)(s),isReadOnly:"true"===s.getAttribute("data-read-only")}),ue({element:s,spotId:c,postId:d,isLiveBlog:m,force:_,instanceId:f,store:y}),l.a.subscribe((function(e){pe({user:e,element:s,postId:d,isLiveBlog:m,contentType:b,store:y})})),l.a.subscribeToToken((function(e){y.getState().appState.isTokenInitialized||y.dispatch(Object(X.b)({isTokenInitialized:!0})),y.dispatch(Object(te.b)(e.networkId,e.token))})),!m){e.next=24;break}return e.next=22,Object(K.a)("v1.0.0/config/liveblog/".concat(c,"/").concat(d),{method:"GET",postId:d,data:{}});case 22:(h=e.sent)&&y.dispatch(Object(p.f)(h.event));case 24:Promise.all([n.e(0),n.e(3),n.e(4),n.e(5),n.e(10),n.e(11),n.e(12),n.e(16),n.e(17),n.e(81),n.e(2),n.e(1),n.e(6),n.e(7),n.e(8),n.e(9),n.e(14),n.e(15),n.e(13),n.e(19),n.e(55)]).then(n.bind(null,896)).then((function(e){e.preRender(s,{store:y,postId:d,isLiveBlog:m,contentType:b,isConversationPage:"true"===s.getAttribute("data-spotim-conversation-page")})})),ie([],y),Object(u.a)(),Z(y.getState());case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=boot-bundle.js.map